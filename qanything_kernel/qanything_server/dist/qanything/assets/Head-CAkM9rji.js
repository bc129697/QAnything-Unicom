import { g as e, m as n, bx as a, _ as t, a5 as i, by as l, ax as o, t as c, d as s, aO as r, aS as u, a as d, aZ as h, r as v, w as g, u as p, o as m, a0 as w, c as k, h as f, aU as y, ao as b, a7 as S, bz as C, P as M, aD as I, I as $, am as x, bu as z, j as A, au as P, k as O, l as E, n as _, q as H, R as j, v as T, H as L, Q as N, x as B, z as F, y as D, W as R, T as U, A as W, C as J, D as q, F as V, O as X, M as Q, X as K, Y as G, Z as Y, p as Z, e as ee, G as ne, an as ae, J as te, K as ie, E as le, bA as oe, bB as ce, bC as se, B as re } from "./index-BVM7diGR.js"; import { g as ue, u as de } from "./index-DAdVxPIc.js"; import { r as he } from "./router-DVUaRRVo.js"; import { b as ve, a as ge, L as pe, u as me } from "./useKnowledgeBase-DZuffAZO.js"; import { _ as we, a as ke, c as fe } from "./index-BTL0xIAV.js"; import { u as ye } from "./useChatSetting-CpQu1AXT.js"; import { r as be, u as Se, e as Ce } from "./urlConfig-5Ad6E0st.js"; import { S as Me } from "./index-DGrp3_20.js"; import { _ as Ie } from "./index-K3ROrwfH.js"; import { _ as $e } from "./RightOutlined-DtsVRhmk.js"; import { _ as xe } from "./LeftOutlined-BC9u9Wti.js"; const ze = e => { const { componentCls: n } = e, a = `${n}-inner`; return { [n]: { [`&${n}-small`]: { minWidth: e.switchMinWidthSM, height: e.switchHeightSM, lineHeight: `${e.switchHeightSM}px`, [`${n}-inner`]: { paddingInlineStart: e.switchInnerMarginMaxSM, paddingInlineEnd: e.switchInnerMarginMinSM, [`${a}-checked`]: { marginInlineStart: `calc(-100% + ${e.switchPinSizeSM + 2 * e.switchPadding}px - ${2 * e.switchInnerMarginMaxSM}px)`, marginInlineEnd: `calc(100% - ${e.switchPinSizeSM + 2 * e.switchPadding}px + ${2 * e.switchInnerMarginMaxSM}px)` }, [`${a}-unchecked`]: { marginTop: -e.switchHeightSM, marginInlineStart: 0, marginInlineEnd: 0 } }, [`${n}-handle`]: { width: e.switchPinSizeSM, height: e.switchPinSizeSM }, [`${n}-loading-icon`]: { top: (e.switchPinSizeSM - e.switchLoadingIconSize) / 2, fontSize: e.switchLoadingIconSize }, [`&${n}-checked`]: { [`${n}-inner`]: { paddingInlineStart: e.switchInnerMarginMinSM, paddingInlineEnd: e.switchInnerMarginMaxSM, [`${a}-checked`]: { marginInlineStart: 0, marginInlineEnd: 0 }, [`${a}-unchecked`]: { marginInlineStart: `calc(100% - ${e.switchPinSizeSM + 2 * e.switchPadding}px + ${2 * e.switchInnerMarginMaxSM}px)`, marginInlineEnd: `calc(-100% + ${e.switchPinSizeSM + 2 * e.switchPadding}px - ${2 * e.switchInnerMarginMaxSM}px)` } }, [`${n}-handle`]: { insetInlineStart: `calc(100% - ${e.switchPinSizeSM + e.switchPadding}px)` } }, [`&:not(${n}-disabled):active`]: { [`&:not(${n}-checked) ${a}`]: { [`${a}-unchecked`]: { marginInlineStart: e.marginXXS / 2, marginInlineEnd: -e.marginXXS / 2 } }, [`&${n}-checked ${a}`]: { [`${a}-checked`]: { marginInlineStart: -e.marginXXS / 2, marginInlineEnd: e.marginXXS / 2 } } } } } } }, Ae = e => { const { componentCls: n } = e; return { [n]: { [`${n}-loading-icon${e.iconCls}`]: { position: "relative", top: (e.switchPinSize - e.fontSize) / 2, color: e.switchLoadingIconColor, verticalAlign: "top" }, [`&${n}-checked ${n}-loading-icon`]: { color: e.switchColor } } } }, Pe = e => { const { componentCls: n } = e, a = `${n}-handle`; return { [n]: { [a]: { position: "absolute", top: e.switchPadding, insetInlineStart: e.switchPadding, width: e.switchPinSize, height: e.switchPinSize, transition: `all ${e.switchDuration} ease-in-out`, "&::before": { position: "absolute", top: 0, insetInlineEnd: 0, bottom: 0, insetInlineStart: 0, backgroundColor: e.colorWhite, borderRadius: e.switchPinSize / 2, boxShadow: e.switchHandleShadow, transition: `all ${e.switchDuration} ease-in-out`, content: '""' } }, [`&${n}-checked ${a}`]: { insetInlineStart: `calc(100% - ${e.switchPinSize + e.switchPadding}px)` }, [`&:not(${n}-disabled):active`]: { [`${a}::before`]: { insetInlineEnd: e.switchHandleActiveInset, insetInlineStart: 0 }, [`&${n}-checked ${a}::before`]: { insetInlineEnd: 0, insetInlineStart: e.switchHandleActiveInset } } } } }, Oe = e => { const { componentCls: n } = e, a = `${n}-inner`; return { [n]: { [a]: { display: "block", overflow: "hidden", borderRadius: 100, height: "100%", paddingInlineStart: e.switchInnerMarginMax, paddingInlineEnd: e.switchInnerMarginMin, transition: `padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`, [`${a}-checked, ${a}-unchecked`]: { display: "block", color: e.colorTextLightSolid, fontSize: e.fontSizeSM, transition: `margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`, pointerEvents: "none" }, [`${a}-checked`]: { marginInlineStart: `calc(-100% + ${e.switchPinSize + 2 * e.switchPadding}px - ${2 * e.switchInnerMarginMax}px)`, marginInlineEnd: `calc(100% - ${e.switchPinSize + 2 * e.switchPadding}px + ${2 * e.switchInnerMarginMax}px)` }, [`${a}-unchecked`]: { marginTop: -e.switchHeight, marginInlineStart: 0, marginInlineEnd: 0 } }, [`&${n}-checked ${a}`]: { paddingInlineStart: e.switchInnerMarginMin, paddingInlineEnd: e.switchInnerMarginMax, [`${a}-checked`]: { marginInlineStart: 0, marginInlineEnd: 0 }, [`${a}-unchecked`]: { marginInlineStart: `calc(100% - ${e.switchPinSize + 2 * e.switchPadding}px + ${2 * e.switchInnerMarginMax}px)`, marginInlineEnd: `calc(-100% + ${e.switchPinSize + 2 * e.switchPadding}px - ${2 * e.switchInnerMarginMax}px)` } }, [`&:not(${n}-disabled):active`]: { [`&:not(${n}-checked) ${a}`]: { [`${a}-unchecked`]: { marginInlineStart: 2 * e.switchPadding, marginInlineEnd: 2 * -e.switchPadding } }, [`&${n}-checked ${a}`]: { [`${a}-checked`]: { marginInlineStart: 2 * -e.switchPadding, marginInlineEnd: 2 * e.switchPadding } } } } } }, Ee = e => { const { componentCls: n } = e; return { [n]: t(t(t(t({}, i(e)), { position: "relative", display: "inline-block", boxSizing: "border-box", minWidth: e.switchMinWidth, height: e.switchHeight, lineHeight: `${e.switchHeight}px`, verticalAlign: "middle", background: e.colorTextQuaternary, border: "0", borderRadius: 100, cursor: "pointer", transition: `all ${e.motionDurationMid}`, userSelect: "none", [`&:hover:not(${n}-disabled)`]: { background: e.colorTextTertiary } }), l(e)), { [`&${n}-checked`]: { background: e.switchColor, [`&:hover:not(${n}-disabled)`]: { background: e.colorPrimaryHover } }, [`&${n}-loading, &${n}-disabled`]: { cursor: "not-allowed", opacity: e.switchDisabledOpacity, "*": { boxShadow: "none", cursor: "not-allowed" } }, [`&${n}-rtl`]: { direction: "rtl" } }) } }, _e = e("Switch", (e => { const t = e.fontSize * e.lineHeight, i = e.controlHeight / 2, l = t - 4, o = i - 4, c = n(e, { switchMinWidth: 2 * l + 8, switchHeight: t, switchDuration: e.motionDurationMid, switchColor: e.colorPrimary, switchDisabledOpacity: e.opacityLoading, switchInnerMarginMin: l / 2, switchInnerMarginMax: l + 2 + 4, switchPadding: 2, switchPinSize: l, switchBg: e.colorBgContainer, switchMinWidthSM: 2 * o + 4, switchHeightSM: i, switchInnerMarginMinSM: o / 2, switchInnerMarginMaxSM: o + 2 + 4, switchPinSizeSM: o, switchHandleShadow: `0 2px 4px 0 ${new a("#00230b").setAlpha(.2).toRgbString()}`, switchLoadingIconSize: .75 * e.fontSizeIcon, switchLoadingIconColor: `rgba(0, 0, 0, ${e.opacityLoading})`, switchHandleActiveInset: "-30%" }); return [Ee(c), Oe(c), Pe(c), Ae(c), ze(c)] })), He = c("small", "default"), je = o(s({ compatConfig: { MODE: 3 }, name: "ASwitch", __ANT_SWITCH: !0, inheritAttrs: !1, props: { id: String, prefixCls: String, size: M.oneOf(He), disabled: { type: Boolean, default: void 0 }, checkedChildren: M.any, unCheckedChildren: M.any, tabindex: M.oneOfType([M.string, M.number]), autofocus: { type: Boolean, default: void 0 }, loading: { type: Boolean, default: void 0 }, checked: M.oneOfType([M.string, M.number, M.looseBool]), checkedValue: M.oneOfType([M.string, M.number, M.looseBool]).def(!0), unCheckedValue: M.oneOfType([M.string, M.number, M.looseBool]).def(!1), onChange: { type: Function }, onClick: { type: Function }, onKeydown: { type: Function }, onMouseup: { type: Function }, "onUpdate:checked": { type: Function }, onBlur: Function, onFocus: Function }, slots: Object, setup(e, n) { let { attrs: a, slots: t, expose: i, emit: l } = n; const o = r(), c = u(), s = d((() => { var n; return null !== (n = e.disabled) && void 0 !== n ? n : c.value })); h((() => { })); const M = v(void 0 !== e.checked ? e.checked : a.defaultChecked), $ = d((() => M.value === e.checkedValue)); g((() => e.checked), (() => { M.value = e.checked })); const { prefixCls: x, direction: z, size: A } = p("switch", e), [P, O] = _e(x), E = v(), _ = () => { var e; null === (e = E.value) || void 0 === e || e.focus() }; i({ focus: _, blur: () => { var e; null === (e = E.value) || void 0 === e || e.blur() } }), m((() => { w((() => { e.autofocus && !s.value && E.value.focus() })) })); const H = (e, n) => { s.value || (l("update:checked", e), l("change", e, n), o.onFieldChange()) }, j = e => { l("blur", e) }, T = n => { _(); const a = $.value ? e.unCheckedValue : e.checkedValue; H(a, n), l("click", a, n) }, L = n => { n.keyCode === I.LEFT ? H(e.unCheckedValue, n) : n.keyCode === I.RIGHT && H(e.checkedValue, n), l("keydown", n) }, N = e => { var n; null === (n = E.value) || void 0 === n || n.blur(), l("mouseup", e) }, B = d((() => ({ [`${x.value}-small`]: "small" === A.value, [`${x.value}-loading`]: e.loading, [`${x.value}-checked`]: $.value, [`${x.value}-disabled`]: s.value, [x.value]: !0, [`${x.value}-rtl`]: "rtl" === z.value, [O.value]: !0 }))); return () => { var n; return P(k(C, null, { default: () => [k("button", f(f(f({}, y(e, ["prefixCls", "checkedChildren", "unCheckedChildren", "checked", "autofocus", "checkedValue", "unCheckedValue", "id", "onChange", "onUpdate:checked"])), a), {}, { id: null !== (n = e.id) && void 0 !== n ? n : o.id.value, onKeydown: L, onClick: T, onBlur: j, onMouseup: N, type: "button", role: "switch", "aria-checked": M.value, disabled: s.value || e.loading, class: [a.class, B.value], ref: E }), [k("div", { class: `${x.value}-handle` }, [e.loading ? k(b, { class: `${x.value}-loading-icon` }, null) : null]), k("span", { class: `${x.value}-inner` }, [k("span", { class: `${x.value}-inner-checked` }, [S(t, e, "checkedChildren")]), k("span", { class: `${x.value}-inner-unchecked` }, [S(t, e, "unCheckedChildren")])])])] })) } } })); var Te = { icon: { tag: "svg", attrs: { viewBox: "64 64 896 896", focusable: "false" }, children: [{ tag: "path", attrs: { d: "M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z" } }] }, name: "line-chart", theme: "outlined" }; function Le(e) { for (var n = 1; n < arguments.length; n++) { var a = null != arguments[n] ? Object(arguments[n]) : {}, t = Object.keys(a); "function" == typeof Object.getOwnPropertySymbols && (t = t.concat(Object.getOwnPropertySymbols(a).filter((function (e) { return Object.getOwnPropertyDescriptor(a, e).enumerable })))), t.forEach((function (n) { Ne(e, n, a[n]) })) } return e } function Ne(e, n, a) { return n in e ? Object.defineProperty(e, n, { value: a, enumerable: !0, configurable: !0, writable: !0 }) : e[n] = a, e } var Be = function (e, n) { var a = Le({}, e, n.attrs); return k($, Le({}, a, { icon: Te }), null) }; Be.displayName = "LineChartOutlined", Be.inheritAttrs = !1; var Fe = { icon: { tag: "svg", attrs: { viewBox: "64 64 896 896", focusable: "false" }, children: [{ tag: "path", attrs: { d: "M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z" } }, { tag: "path", attrs: { d: "M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" } }] }, name: "minus-circle", theme: "outlined" }; function De(e) { for (var n = 1; n < arguments.length; n++) { var a = null != arguments[n] ? Object(arguments[n]) : {}, t = Object.keys(a); "function" == typeof Object.getOwnPropertySymbols && (t = t.concat(Object.getOwnPropertySymbols(a).filter((function (e) { return Object.getOwnPropertyDescriptor(a, e).enumerable })))), t.forEach((function (n) { Re(e, n, a[n]) })) } return e } function Re(e, n, a) { return n in e ? Object.defineProperty(e, n, { value: a, enumerable: !0, configurable: !0, writable: !0 }) : e[n] = a, e } var Ue = function (e, n) { var a = De({}, e, n.attrs); return k($, De({}, a, { icon: Fe }), null) }; Ue.displayName = "MinusCircleOutlined", Ue.inheritAttrs = !1; var We = { icon: { tag: "svg", attrs: { viewBox: "64 64 896 896", focusable: "false" }, children: [{ tag: "path", attrs: { d: "M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z" } }, { tag: "path", attrs: { d: "M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" } }] }, name: "plus-circle", theme: "outlined" }; function Je(e) { for (var n = 1; n < arguments.length; n++) { var a = null != arguments[n] ? Object(arguments[n]) : {}, t = Object.keys(a); "function" == typeof Object.getOwnPropertySymbols && (t = t.concat(Object.getOwnPropertySymbols(a).filter((function (e) { return Object.getOwnPropertyDescriptor(a, e).enumerable })))), t.forEach((function (n) { qe(e, n, a[n]) })) } return e } function qe(e, n, a) { return n in e ? Object.defineProperty(e, n, { value: a, enumerable: !0, configurable: !0, writable: !0 }) : e[n] = a, e } var Ve = function (e, n) { var a = Je({}, e, n.attrs); return k($, Je({}, a, { icon: We }), null) }; Ve.displayName = "PlusCircleOutlined", Ve.inheritAttrs = !1; const Xe = x("useHeader", (() => { const e = z(), n = new Map([["statistics", -1], ["home", 0], ["bot", 1], ["quickstart", 2]]), a = v((() => { const a = e.currentRoute.value.path; return n.get(a.split("/")[1]) })()); return { navIndex: a, setNavIndex: e => { a.value = e } } })), Qe = { class: "modal-edit" }, Ke = { class: "modal-content", style: { width: "auto" } }, Ge = { key: 0 }, Ye = ["innerHTML"], Ze = q(s({ __name: "ChunkCardModal", props: { chunk: { type: Object, required: !0 }, showChunkCardModal: { type: Boolean, required: !0 } }, emits: ["close-modal"], setup(e, { emit: n }) { const { chatSettingFormActive: a } = A(ye()), { common: t } = ue(), i = e, l = n, o = v(i.showChunkCardModal), c = v(!1), s = v({}), r = v(!1), u = v(null), d = v("50vw"); P((() => { w((() => { document.querySelectorAll(".edit-textarea").forEach((e => { const n = e.querySelector("table"); if (n) { const e = n.offsetWidth, a = .5 * window.innerWidth; d.value = e > a ? `${e + 50}px` : "50vw" } else d.value = "50vw" })) })) })), g((() => i.showChunkCardModal), (e => o.value = e)); const h = () => { l("close-modal") }; return (n, l) => { const v = J; return O(), E(U, { to: "body" }, [k(v, { theme: { token: { colorPrimary: "#5a47e5" } } }, { default: _((() => [k(H(j), { open: H(o), "onUpdate:open": l[2] || (l[2] = e => T(o) ? o.value = e : null), class: "card-content", style: { top: "20px" }, width: H(d), "cancel-text": H(t).cancel, "ok-text": H(t).save, "confirm-loading": H(r), onCancel: l[3] || (l[3] = n => { return a = e.chunk.key, c.value = !1, h(), s.value[a] && delete s.value[a], void (u.value && (u.value.abort(), u.value = null)); var a }), onOk: l[4] || (l[4] = () => (async e => { if (!c.value || s.value[e].editContent === i.chunk.editContent) return c.value = !1, void h(); r.value = !0; const n = W.loading("保存中...", 0); u.value = new AbortController; const t = u.value.signal; try { await be(await Se.updateDocCompleted({ chunk_size: a.value.chunkSize, doc_id: e, update_content: s.value[e].editContent }, { signal: t })), W.success("修改成功"), c.value = !1, s.value[e].content = s.value[e].editContent, Object.assign(i.chunk, s.value[e]), delete s.value[e] } catch (l) { "AbortError" === l.name ? W.info("请求已取消") : W.error(l.msg) } finally { r.value = !1, h(), n() } })(e.chunk.key)) }, { default: _((() => { return [L("div", Qe, [k(H(N), { size: "small", type: "primary", onClick: l[0] || (l[0] = n => { return a = e.chunk.key, void (H(c) ? (c.value = !1, s.value[a] && delete s.value[a]) : (c.value = !0, s.value[a] = JSON.parse(JSON.stringify(i.chunk)))); var a }) }, { default: _((() => [B(F(H(c) ? H(t).cancel : H(t).edit), 1)])), _: 1 })]), L("div", Ke, [H(c) ? (O(), D("div", Ge, [H(s)[e.chunk.key] ? (O(), E(H(R), { key: 0, value: H(s)[e.chunk.key].editContent, "onUpdate:value": l[1] || (l[1] = n => H(s)[e.chunk.key].editContent = n), class: "edit-textarea", "show-count": "", "auto-size": "" }, null, 8, ["value"])) : (O(), D("div", { key: 1, class: "edit-textarea", innerHTML: (n = e.chunk.content, n.replace(/\n/g, "<br />")) }, null, 8, Ye))])) : (O(), E(we, { key: 1, class: "edit-textarea", content: H(s)[e.chunk.key] ? H(s)[e.chunk.key].editContent : e.chunk.content }, null, 8, ["content"]))])]; var n })), _: 1 }, 8, ["open", "width", "cancel-text", "ok-text", "confirm-loading"])])), _: 1 })]) } } }), [["__scopeId", "data-v-6071729b"]]), en = e => (K("data-v-59873bb7"), e = e(), G(), e), nn = { class: "card-header" }, an = { class: "card-title" }, tn = en((() => L("b", null, "#", -1))), ln = { class: "card-head-right" }, on = { class: "select-desc" }, cn = { key: 0 }, sn = { key: 0, class: "card-content-hover" }, rn = en((() => L("div", { class: "card-content-cover" }, null, -1))), un = q(s({ __name: "ChunkCard", props: { chunk: {}, isSelected: { type: Boolean } }, emits: ["select"], setup(e, { emit: n }) { const a = e, t = n, i = v(!1), l = v(!1), o = v(a.chunk.editContent), c = () => t("select", a.chunk), s = () => { i.value = !0 }, r = () => { i.value = !1 }; return g((() => a.chunk.editContent), (e => { o.value = e })), (e, n) => (O(), D(Q, null, [L("div", { class: "card", onMouseenter: n[0] || (n[0] = e => l.value = !0), onMouseleave: n[1] || (n[1] = e => l.value = !1) }, [L("div", nn, [L("div", an, [L("span", null, [tn, B(" " + F(e.chunk.id), 1)])]), L("div", ln, [L("div", null, [L("span", on, F(e.isSelected ? "导出已选中" : "导出未选中"), 1)]), L("div", { class: V(["select-icon", e.isSelected ? "select-icon-green" : "select-icon-gray"]) }, null, 2), l.value ? (O(), D("div", cn, [k(H(je), { checked: e.isSelected, size: "small", onClick: c }, null, 8, ["checked"])])) : X("", !0)])]), L("div", { class: "card-content", onClick: s }, [k(we, { content: e.chunk.content }, null, 8, ["content"]), l.value ? (O(), D("span", sn)) : X("", !0), rn])], 32), k(Ze, { "show-chunk-card-modal": i.value, chunk: e.chunk, onCloseModal: r }, null, 8, ["show-chunk-card-modal", "chunk"])], 64)) } }), [["__scopeId", "data-v-59873bb7"]]), dn = e => (K("data-v-e57d451a"), e = e(), G(), e), hn = { class: "container" }, vn = { class: "scale" }, gn = { class: "scale-text" }, pn = dn((() => L("div", { class: "resize-handle" }, null, -1))), mn = { ref: "tableDomRef", class: "chunk-table" }, wn = { class: "export" }, kn = { style: { color: "#666", "user-select": "text" } }, fn = { class: "file-path" }, yn = dn((() => L("div", null, [L("span", { class: "select-desc" }, " 本页全选 ")], -1))), bn = { key: 0 }, Sn = { class: "card-container" }, Cn = { key: 0, class: "chunk-cards" }, Mn = { class: "chunk-pagination" }, In = { class: "footer" }, $n = q(s({ __name: "ChunkViewDialog", props: { kbId: {}, fileId: {}, fileName: {} }, setup(e) { const { showChunkModel: n, chunkCacheData: a } = A(ve()), { common: t } = ue(), { setSourceUrl: i, setTextContent: l, setPreLoading: o } = ke(), { preLoading: c, sourceType: s } = A(ke()), { handleChatSource: r } = ge(), u = e, { kbId: d, fileId: h, fileName: p } = Y(u), m = v(!0), w = v(new Map), f = v(!1), y = v(null), b = e => e.every((e => w.value.has(e.key))), S = e => { const n = e.key, a = e.content; w.value.has(n) ? w.value.delete(n) : w.value.set(n, a) }, C = () => { let e = "";[...w.value.values()].map((n => { e += n + "\n\n" })), M(e) }, M = e => { try { const n = "output.txt", a = new File([e], n, { type: "text/plain;charset=utf-8" }), t = URL.createObjectURL(a); Ce(t, n), w.value.clear() } catch (n) { W.error("download error") } }, I = v({ pageNum: 1, pageSize: 1, total: 0, showSizeChanger: !1, showTotal: e => `共 ${e} 页` }); Z("setTotal", (e => { I.value.total = e })); let $ = v(!1); const x = e => { $.value = !0, I.value.pageNum = e, z(e), setTimeout((() => { $.value = !1 }), 500) }, z = e => { const n = y.value, a = n.querySelector(`.vue-office-pdf-wrapper [data-page="${e}"]`); if (a) { const { top: e } = a.getBoundingClientRect(), { top: t } = n.getBoundingClientRect(), i = e - t + n.scrollTop; n.scrollTo({ top: i, behavior: "smooth" }) } }, P = () => { if ($) return; const e = y.value, n = e.querySelectorAll(".vue-office-pdf-wrapper canvas"), a = e.getBoundingClientRect().top, t = e.getBoundingClientRect().bottom; n.forEach(((e, n) => { const { top: i, bottom: l } = e.getBoundingClientRect(); Math.abs(i - a) < 10 && l <= t && (I.value.pageNum = n + 1) })) }; Z("resizePreview", (() => { const e = document.querySelector(".preview-content"); if (e) { const n = e.offsetWidth, a = .5 * window.innerWidth; Ae(Math.min(n, a)) } })); const R = v({ pageNum: 1, pageSize: 24, total: 0, showSizeChanger: !1, showTotal: e => `共 ${e} 条` }), q = e => { R.value.pageNum = e, he(d.value, h.value) }, K = v([]), G = v(1), oe = v(""), ce = () => { n.value = !1 }, se = v(1), re = () => { se.value += .1 }, de = () => { se.value <= .15 || (se.value -= .1) }, he = async (e, n) => { const t = `chunkCache_${u.fileId}`; if (m.value = !0, 1 === R.value.pageNum && a && a.value) { const e = a.value.get(t); if (e) return K.value = e.data, R.value.total = e.total, void (m.value = !1) } try { const i = await be(await Se.getDocCompleted({ kb_id: e, file_id: n, page_id: R.value.pageNum, page_limit: R.value.pageSize })); if (G.value = (R.value.pageNum - 1) * R.value.pageSize + 1, R.value.total = i.total_count, K.value = [], oe.value = i.file_path, i.chunks.forEach((e => { K.value.push({ key: e.chunk_id, id: G.value++, content: e.page_content, editContent: e.page_content }) })), 1 === R.value.pageNum) { const e = { data: [...K.value], total: i.total_count }; a.value.set(t, e) } } catch (i) { W.error(i.msg || "获取文档解析结果失败") } finally { m.value = !1 } }; g((() => n.value), (async e => { e ? (K.value = [], await he(d.value, h.value), r({ file_id: h.value, file_name: p.value })) : me() })); const me = () => { se.value = 1, K.value = [], G.value = 1, R.value.pageNum = 1, R.value.total = 1, i(""), l(""), w.value.clear(), o(!0), m.value = !0, I.value.pageNum = 1, I.value.total = 1 }, we = v(!1), ye = v(0), xe = v(0), ze = v("40%"), Ae = e => { e >= 300 && (ze.value = `${e}px`) }, Pe = e => { e.target.classList.contains("resize-handle") && (we.value = !0, ye.value = e.clientX, xe.value = e.target.parentElement.offsetWidth, window.addEventListener("mousemove", Oe), window.addEventListener("mouseup", Ee)) }, Oe = e => { if (we.value) { const n = e.clientX - ye.value, a = xe.value + n; Ae(a) } }, Ee = () => { we.value && (we.value = !1, window.removeEventListener("mousemove", Oe), window.removeEventListener("mouseup", Ee)) }; Z("setScrollToCenter", (() => { const e = y.value; if (e) { const n = (e.scrollWidth - e.clientWidth) / 2; e.scrollLeft = n } })); const { x: _e, y: He } = fe(y); let Te = null; return g([_e, He], (([e, n], [a, t]) => { n !== t && e === a && y.value.classList.add("scrolling"), clearTimeout(Te), Te = setTimeout((() => { y.value.classList.remove("scrolling") }), 500) })), ee((() => { Te && clearTimeout(Te) })), (e, a) => { const i = Ie, l = N, o = $e, r = je, d = un, h = j, v = J; return O(), E(U, { to: "body" }, [k(v, { theme: { token: { colorPrimary: "#5a47e5" } } }, { default: _((() => [k(h, { open: H(n), "onUpdate:open": a[3] || (a[3] = e => T(n) ? n.value = e : null), title: "切片分析结果", centered: "", width: "100%", "wrap-class-name": "chunk-modal", "destroy-on-close": "", footer: null, onCancel: ce }, { default: _((() => [L("div", hn, [L("div", { class: "file-preview", style: ne({ width: H(ze) }), onMousedown: Pe }, [L("div", { class: "preview-header", style: ne("pdf" === H(s) ? {} : { justifyContent: "end" }) }, ["pdf" === H(s) ? (O(), E(i, { key: 0, total: H(I).total, current: H(I).pageNum, "page-size": H(I).pageSize, "show-total": H(I).showTotal, "show-size-changer": H(I).showSizeChanger, simple: "", onChange: x }, null, 8, ["total", "current", "page-size", "show-total", "show-size-changer"])) : X("", !0), L("div", vn, [k(l, { shape: "circle", icon: ae(H(Ve)), onClick: re }, null, 8, ["icon"]), L("span", gn, F((100 * H(se)).toFixed(0)) + "%", 1), k(l, { shape: "circle", icon: ae(H(Ue)), onClick: de }, null, 8, ["icon"])])], 4), L("div", { ref_key: "filePreviewRef", ref: y, class: "file-preview-content", onScroll: P }, [te(k(Me, { "file-id": u.fileId, "zoom-level": H(se) }, null, 8, ["file-id", "zoom-level"]), [[ie, !H(c)]]), H(c) ? (O(), E(pe, { key: 0, class: "loading-img" })) : X("", !0)], 544), pn], 36), L("div", mn, [L("div", wn, [k(o, { color: "#fff", placement: "bottom" }, { title: _((() => [L("span", kn, F(H(oe)), 1)])), default: _((() => [L("span", fn, "文件与解析结果所在目录: " + F(H(oe)), 1)])), _: 1 }), L("div", { class: "all-select", onMouseenter: a[1] || (a[1] = e => f.value = !0), onMouseleave: a[2] || (a[2] = e => f.value = !1) }, [yn, L("div", { class: V(["select-icon", b(H(K)) ? "select-icon-green" : "select-icon-gray"]) }, null, 2), H(f) ? (O(), D("div", bn, [k(r, { checked: b(H(K)), size: "small", onClick: a[0] || (a[0] = e => { H(K).forEach((e => { const { key: n, content: a } = e; w.value.has(n) ? w.value.delete(n) : w.value.set(n, a) })) }) }, null, 8, ["checked"])])) : X("", !0)], 32), k(l, { type: "primary", onClick: C }, { default: _((() => [B(" 导出选中(" + F(H(w).size) + ") ", 1)])), _: 1 })]), L("div", Sn, [H(m) ? (O(), E(pe, { key: 1, class: "loading-img" })) : (O(), D("div", Cn, [(O(!0), D(Q, null, le(H(K), (e => (O(), E(d, { key: e.key, chunk: e, "is-selected": H(w).has(e.key), onSelect: S }, null, 8, ["chunk", "is-selected"])))), 128))]))]), L("div", Mn, [k(i, { total: H(R).total, current: H(R).pageNum, "page-size": H(R).pageSize, "show-total": H(R).showTotal, "show-size-changer": H(R).showSizeChanger, onChange: q }, null, 8, ["total", "current", "page-size", "show-total", "show-size-changer"])])], 512)]), L("div", In, [k(l, { type: "primary", onClick: ce }, { default: _((() => [B(F(H(t).close), 1)])), _: 1 })])])), _: 1 }, 8, ["open"])])), _: 1 })]) } } }), [["__scopeId", "data-v-e57d451a"]]), xn = e => (K("data-v-23e0597f"), e = e(), G(), e), zn = { class: "header" }, An = { class: "logo" }, Pn = { class: "header-navs" }, On = ["onClick"], En = { class: "phone" }, _n = xn((() => L("p", null, "用户id", -1))), Hn = { class: "toggle-button" }, jn = xn((() => L("span", { class: "line" }, null, -1))), Tn = xn((() => L("p", null, "电话：15520767970", -1))), Ln = xn((() => L("p", null, "邮箱：173889856@qq.com", -1))), Nn = xn((() => L("p", null, "", -1))), Bn = { class: "myspan" }, Fn = xn((() => L("img", { src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEzSURBVFiF7Zc9TsNAEEZfAgfIEVxQUyFRp6bkALmBCx+AIgdIsTeBmibUHMIlTaREQiJCAdPM4NFqiXetEEfKftLIkrU78+bbH8ujpmkuGFDjIYtngJMCuAa2wO5I8QncWoA74PK/ugxoDEwtwJc3YA1UAnWIqCSn1bcFUL0ADpgAC4lJzy4J5HFS41c+wIfQKnEJvAJFj+KFzC1pHa2kxp8AKgfcALWXKFYWvJZcLjRw3zG0E2OXJGS5NhJU1z1gretakoKw5f7mSwJQdS1JtOW+Us6+Jn6QggtaJxTGAXM6uu4LAK21tQHR93Miuw4BbOT5HjnPAU/As8y9Z89G8/Qmz5UF2CYCIAWvEsb72sEJfQ0zQAY4XwD/JpxJHE3qwJKE+/sAqoFHgFH+NcsAQwP8AMm5aVdq5fsTAAAAAElFTkSuQmCC", alt: "技术支持" }, null, -1))), Dn = q(s({ __name: "Head", setup(e) { const { fileId: n, fileIdName: a } = A(ve()), { currentId: t } = A(me()), i = ue().header, { language: l } = A(de()), { navIndex: o } = A(Xe()), { setLanguage: c } = de(), { setNavIndex: s } = Xe(), { changePage: r } = he(), { userInfo: u, setPhoneNumber: d } = oe(), h = [{ name: ue().header.quickStart, value: 2 }, { name: ue().header.knowledge, value: 0 }, { name: "Bots", value: 1 }], g = e => { c(e), window.location.reload() }, p = new Map([[0, "knowledge-icon"], [1, "bot-icon"], [2, "quick-icon"]]), w = () => { s(-1), r("/statistics") }, f = v(""), y = v(""), b = () => { var e; e = f.value, /^[A-Za-z0-9_\-\.]+$/.test(e) ? (d(f.value), y.value = "", W.success("绑定成功"), window.location.reload()) : (y.value = "error", W.error("请输入正确的用户id")) }; return m((() => { f.value = "1" === u.phoneNumber ? "" : u.phoneNumber })), (e, c) => { const u = re, d = xe; return O(), D(Q, null, [L("div", zn, [L("div", An, [L("img", { src: "/qanything/assets/logo-rag.png", style: ne({ marginTop: -1 === H(o) ? "" : "14px", width: "auto", height: "43px" }), alt: "logo", onClick: c[0] || (c[0] = e => { return n = "https://maas-gz.ai-yuanjing.com/", void (window.location.href = n); var n }) }, null, 4)]), L("div", Pn, [(O(), D(Q, null, le(h, (e => { return L("div", { key: e.name, class: V(["nav-item", H(o) === e.value ? "nav-item-active" : ""]), onClick: n => { return a = e.value, void (o.value !== a && (s(a), 0 === a ? r("/home") : 1 === a ? r("/bots") : 2 === a && r("/quickstart"))); var a } }, [L("div", { class: V(["item-icon", (n = e.value, p.get(n))]) }, null, 2), L("span", null, F(e.name), 1)], 10, On); var n })), 64))]), L("ul", null, [L("li", En, [k(d, null, { content: _((() => [_n])), default: _((() => [k(u, { value: H(f), "onUpdate:value": c[1] || (c[1] = e => T(f) ? f.value = e : null), size: "small", status: H(y), style: { width: "100%" }, onBlur: b }, { prefix: _((() => ["error" !== H(y) ? (O(), E(H(ce), { key: 0 })) : (O(), E(H(se), { key: 1 }))])), _: 1 }, 8, ["value", "status"])])), _: 1 })]), L("li", Hn, [L("span", { class: V(["zh" === H(l) ? "active" : ""]), onClick: c[2] || (c[2] = e => g("zh")) }, "中", 2), jn, L("span", { class: V(["en" === H(l) ? "active" : ""]), onClick: c[3] || (c[3] = e => g("en")) }, "En", 2)]), L("li", null, [k(d, { placement: "bottomRight" }, { content: _((() => [Tn, Ln, Nn])), title: _((() => [L("span", null, F(H(i).cooperationMore), 1)])), default: _((() => [L("div", Bn, [Fn, L("span", null, F(H(i).cooperation), 1)])])), _: 1 })]), L("li", null, [L("div", { class: "myspan", onClick: w }, [k(H(Be), { style: { "margin-right": "5px" } }), L("span", null, F(H(i).statistics), 1)])])])]), k($n, { "kb-id": H(t), "file-id": H(n), "file-name": H(a) }, null, 8, ["kb-id", "file-id", "file-name"])], 64) } } }), [["__scopeId", "data-v-23e0597f"]]); export { Dn as H, Xe as u };
