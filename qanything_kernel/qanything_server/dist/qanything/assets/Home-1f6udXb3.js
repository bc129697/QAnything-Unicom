import { u as e, a as t, p as o } from "./useKnowledgeBase-DZuffAZO.js"; import { g as a, u as n } from "./index-DAdVxPIc.js"; import { a2 as l, d as r, a as i, V as s, r as u, w as c, $ as d, _ as p, c as v, f as m, u as g, a3 as h, a4 as f, P as b, g as y, m as w, a5 as k, a6 as C, h as S, a7 as $, a8 as x, a9 as I, aa as O, J as _, K as B, I as D, ab as E, ac as A, ad as j, ae as z, M as L, b as R, p as q, af as T, ag as H, i as M, ah as P, e as F, ai as N, aj as V, a0 as W, o as Q, ak as K, al as U, k as Z, y as G, H as X, z as Y, q as J, X as ee, Y as te, D as oe, A as ae, am as ne, j as le, F as re, N as ie, x as se, E as ue, O as ce, l as de, n as pe, G as ve, v as me, Q as ge, W as he } from "./index-BVM7diGR.js"; import { u as fe, C as be } from "./useUploadFiles-DjlYc-xX.js"; import { u as ye, r as we, a as ke, b as Ce, c as Se, f as $e, C as xe } from "./urlConfig-5Ad6E0st.js"; import { u as Ie, C as Oe, D as _e, f as Be, h as De, _ as Ee, a as Ae, T as je } from "./ChatInfoPanel-Cxesx8km.js"; import { C as ze, u as Le } from "./useChatOperate-DPEKD_Ao.js"; import { _ as Re } from "./index-BTL0xIAV.js"; import { u as qe } from "./useChatSetting-CpQu1AXT.js"; import { u as Te } from "./useBots-wIryKe1o.js"; import { D as He } from "./responsiveObserve-BPfiShJR.js"; import { g as Me, i as Pe, _ as Fe } from "./RightOutlined-DtsVRhmk.js"; import { i as Ne } from "./isNumeric-DFkNItwV.js"; import { u as Ve, _ as We } from "./LeftOutlined-BC9u9Wti.js"; import { s as Qe, g as Ke } from "./index-MUygmPPV.js"; import { O as Ue } from "./OptionList-D_gkNvez.js"; import "./index-BFggBRAt.js"; import "./operationUnit-MUxBaQJQ.js"; import "./index-BUlNCtQT.js"; import "./debounce-Dz27Iuya.js"; import "./collapseMotion-uYR2Sbzz.js"; import "./class-Cc8UO9Y6.js"; import "./index-CBrli1tO.js"; import "./index-K3ROrwfH.js"; import "./index-Dg7oIhYm.js"; import "./injectionKey-BS_bSTfS.js"; function Ze(e) { let t; const o = function () { if (null == t) { for (var o = arguments.length, a = new Array(o), n = 0; n < o; n++)a[n] = arguments[n]; t = l((o => () => { t = null, e(...o) })(a)) } }; return o.cancel = () => { l.cancel(t), t = null }, o } function Ge(e) { let t, { prefixCls: o, value: a, current: n, offset: l = 0 } = e; return l && (t = { position: "absolute", top: `${l}00%`, left: 0 }), v("p", { style: t, class: m(`${o}-only-unit`, { current: n }) }, [a]) } function Xe(e, t, o) { let a = e, n = 0; for (; (a + 10) % 10 !== t;)a += o, n += o; return n } const Ye = r({ compatConfig: { MODE: 3 }, name: "SingleNumber", props: { prefixCls: String, value: String, count: Number }, setup(e) { const t = i((() => Number(e.value))), o = i((() => Math.abs(e.count))), a = s({ prevValue: t.value, prevCount: o.value }), n = () => { a.prevValue = t.value, a.prevCount = o.value }, l = u(); return c(t, (() => { clearTimeout(l.value), l.value = setTimeout((() => { n() }), 1e3) }), { flush: "post" }), d((() => { clearTimeout(l.value) })), () => { let l, r = {}; const i = t.value; if (a.prevValue === i || Number.isNaN(i) || Number.isNaN(a.prevValue)) l = [Ge(p(p({}, e), { current: !0 }))], r = { transition: "none" }; else { l = []; const t = i + 10, n = []; for (let e = i; e <= t; e += 1)n.push(e); const s = n.findIndex((e => e % 10 === a.prevValue)); l = n.map(((t, o) => { const a = t % 10; return Ge(p(p({}, e), { value: a, offset: o - s, current: o === s })) })); const u = a.prevCount < o.value ? 1 : -1; r = { transform: `translateY(${-Xe(a.prevValue, i, u)}00%)` } } return v("span", { class: `${e.prefixCls}-only`, style: r, onTransitionend: () => n() }, [l]) } } }); const Je = r({ compatConfig: { MODE: 3 }, name: "ScrollNumber", inheritAttrs: !1, props: { prefixCls: String, count: b.any, component: String, title: b.any, show: Boolean }, setup(e, t) { let { attrs: o, slots: a } = t; const { prefixCls: n } = g("scroll-number", e); return () => { var t; const l = p(p({}, e), o), { prefixCls: r, count: i, title: s, show: u, component: c = "sup", class: d, style: g } = l, b = function (e, t) { var o = {}; for (var a in e) Object.prototype.hasOwnProperty.call(e, a) && t.indexOf(a) < 0 && (o[a] = e[a]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var n = 0; for (a = Object.getOwnPropertySymbols(e); n < a.length; n++)t.indexOf(a[n]) < 0 && Object.prototype.propertyIsEnumerable.call(e, a[n]) && (o[a[n]] = e[a[n]]) } return o }(l, ["prefixCls", "count", "title", "show", "component", "class", "style"]), y = p(p({}, b), { style: g, "data-show": e.show, class: m(n.value, d), title: s }); let w = i; if (i && Number(i) % 1 == 0) { const e = String(i).split(""); w = e.map(((t, o) => v(Ye, { prefixCls: n.value, count: Number(i), value: t, key: e.length - o }, null))) } g && g.borderColor && (y.style = p(p({}, g), { boxShadow: `0 0 0 1px ${g.borderColor} inset` })); const k = h(null === (t = a.default) || void 0 === t ? void 0 : t.call(a)); return k && k.length ? f(k, { class: m(`${n.value}-custom-component`) }, !1) : v(c, y, { default: () => [w] }) } } }), et = new C("antStatusProcessing", { "0%": { transform: "scale(0.8)", opacity: .5 }, "100%": { transform: "scale(2.4)", opacity: 0 } }), tt = new C("antZoomBadgeIn", { "0%": { transform: "scale(0) translate(50%, -50%)", opacity: 0 }, "100%": { transform: "scale(1) translate(50%, -50%)" } }), ot = new C("antZoomBadgeOut", { "0%": { transform: "scale(1) translate(50%, -50%)" }, "100%": { transform: "scale(0) translate(50%, -50%)", opacity: 0 } }), at = new C("antNoWrapperZoomBadgeIn", { "0%": { transform: "scale(0)", opacity: 0 }, "100%": { transform: "scale(1)" } }), nt = new C("antNoWrapperZoomBadgeOut", { "0%": { transform: "scale(1)" }, "100%": { transform: "scale(0)", opacity: 0 } }), lt = new C("antBadgeLoadingCircle", { "0%": { transformOrigin: "50%" }, "100%": { transform: "translate(50%, -50%) rotate(360deg)", transformOrigin: "50%" } }), rt = e => { const { componentCls: t, iconCls: o, antCls: a, badgeFontHeight: n, badgeShadowSize: l, badgeHeightSm: r, motionDurationSlow: i, badgeStatusSize: s, marginXS: u, badgeRibbonOffset: c } = e, d = `${a}-scroll-number`, v = `${a}-ribbon`, m = `${a}-ribbon-wrapper`, g = Me(e, ((e, o) => { let { darkColor: a } = o; return { [`&${t} ${t}-color-${e}`]: { background: a, [`&:not(${t}-count)`]: { color: a } } } })), h = Me(e, ((e, t) => { let { darkColor: o } = t; return { [`&${v}-color-${e}`]: { background: o, color: o } } })); return { [t]: p(p(p(p({}, k(e)), { position: "relative", display: "inline-block", width: "fit-content", lineHeight: 1, [`${t}-count`]: { zIndex: e.badgeZIndex, minWidth: e.badgeHeight, height: e.badgeHeight, color: e.badgeTextColor, fontWeight: e.badgeFontWeight, fontSize: e.badgeFontSize, lineHeight: `${e.badgeHeight}px`, whiteSpace: "nowrap", textAlign: "center", background: e.badgeColor, borderRadius: e.badgeHeight / 2, boxShadow: `0 0 0 ${l}px ${e.badgeShadowColor}`, transition: `background ${e.motionDurationMid}`, a: { color: e.badgeTextColor }, "a:hover": { color: e.badgeTextColor }, "a:hover &": { background: e.badgeColorHover } }, [`${t}-count-sm`]: { minWidth: r, height: r, fontSize: e.badgeFontSizeSm, lineHeight: `${r}px`, borderRadius: r / 2 }, [`${t}-multiple-words`]: { padding: `0 ${e.paddingXS}px` }, [`${t}-dot`]: { zIndex: e.badgeZIndex, width: e.badgeDotSize, minWidth: e.badgeDotSize, height: e.badgeDotSize, background: e.badgeColor, borderRadius: "100%", boxShadow: `0 0 0 ${l}px ${e.badgeShadowColor}` }, [`${t}-dot${d}`]: { transition: `background ${i}` }, [`${t}-count, ${t}-dot, ${d}-custom-component`]: { position: "absolute", top: 0, insetInlineEnd: 0, transform: "translate(50%, -50%)", transformOrigin: "100% 0%", [`&${o}-spin`]: { animationName: lt, animationDuration: "1s", animationIterationCount: "infinite", animationTimingFunction: "linear" } }, [`&${t}-status`]: { lineHeight: "inherit", verticalAlign: "baseline", [`${t}-status-dot`]: { position: "relative", top: -1, display: "inline-block", width: s, height: s, verticalAlign: "middle", borderRadius: "50%" }, [`${t}-status-success`]: { backgroundColor: e.colorSuccess }, [`${t}-status-processing`]: { overflow: "visible", color: e.colorPrimary, backgroundColor: e.colorPrimary, "&::after": { position: "absolute", top: 0, insetInlineStart: 0, width: "100%", height: "100%", borderWidth: l, borderStyle: "solid", borderColor: "inherit", borderRadius: "50%", animationName: et, animationDuration: e.badgeProcessingDuration, animationIterationCount: "infinite", animationTimingFunction: "ease-in-out", content: '""' } }, [`${t}-status-default`]: { backgroundColor: e.colorTextPlaceholder }, [`${t}-status-error`]: { backgroundColor: e.colorError }, [`${t}-status-warning`]: { backgroundColor: e.colorWarning }, [`${t}-status-text`]: { marginInlineStart: u, color: e.colorText, fontSize: e.fontSize } } }), g), { [`${t}-zoom-appear, ${t}-zoom-enter`]: { animationName: tt, animationDuration: e.motionDurationSlow, animationTimingFunction: e.motionEaseOutBack, animationFillMode: "both" }, [`${t}-zoom-leave`]: { animationName: ot, animationDuration: e.motionDurationSlow, animationTimingFunction: e.motionEaseOutBack, animationFillMode: "both" }, [`&${t}-not-a-wrapper`]: { [`${t}-zoom-appear, ${t}-zoom-enter`]: { animationName: at, animationDuration: e.motionDurationSlow, animationTimingFunction: e.motionEaseOutBack }, [`${t}-zoom-leave`]: { animationName: nt, animationDuration: e.motionDurationSlow, animationTimingFunction: e.motionEaseOutBack }, [`&:not(${t}-status)`]: { verticalAlign: "middle" }, [`${d}-custom-component, ${t}-count`]: { transform: "none" }, [`${d}-custom-component, ${d}`]: { position: "relative", top: "auto", display: "block", transformOrigin: "50% 50%" } }, [`${d}`]: { overflow: "hidden", [`${d}-only`]: { position: "relative", display: "inline-block", height: e.badgeHeight, transition: `all ${e.motionDurationSlow} ${e.motionEaseOutBack}`, WebkitTransformStyle: "preserve-3d", WebkitBackfaceVisibility: "hidden", [`> p${d}-only-unit`]: { height: e.badgeHeight, margin: 0, WebkitTransformStyle: "preserve-3d", WebkitBackfaceVisibility: "hidden" } }, [`${d}-symbol`]: { verticalAlign: "top" } }, "&-rtl": { direction: "rtl", [`${t}-count, ${t}-dot, ${d}-custom-component`]: { transform: "translate(-50%, -50%)" } } }), [`${m}`]: { position: "relative" }, [`${v}`]: p(p(p(p({}, k(e)), { position: "absolute", top: u, padding: `0 ${e.paddingXS}px`, color: e.colorPrimary, lineHeight: `${n}px`, whiteSpace: "nowrap", backgroundColor: e.colorPrimary, borderRadius: e.borderRadiusSM, [`${v}-text`]: { color: e.colorTextLightSolid }, [`${v}-corner`]: { position: "absolute", top: "100%", width: c, height: c, color: "currentcolor", border: c / 2 + "px solid", transform: e.badgeRibbonCornerTransform, transformOrigin: "top", filter: e.badgeRibbonCornerFilter } }), h), { [`&${v}-placement-end`]: { insetInlineEnd: -c, borderEndEndRadius: 0, [`${v}-corner`]: { insetInlineEnd: 0, borderInlineEndColor: "transparent", borderBlockEndColor: "transparent" } }, [`&${v}-placement-start`]: { insetInlineStart: -c, borderEndStartRadius: 0, [`${v}-corner`]: { insetInlineStart: 0, borderBlockEndColor: "transparent", borderInlineStartColor: "transparent" } }, "&-rtl": { direction: "rtl" } }) } }, it = y("Badge", (e => { const { fontSize: t, lineHeight: o, fontSizeSM: a, lineWidth: n, marginXS: l, colorBorderBg: r } = e, i = Math.round(t * o), s = n, u = i - 2 * s, c = e.colorBgContainer, d = a, p = e.colorError, v = e.colorErrorHover, m = w(e, { badgeFontHeight: i, badgeShadowSize: s, badgeZIndex: "auto", badgeHeight: u, badgeTextColor: c, badgeFontWeight: "normal", badgeFontSize: d, badgeColor: p, badgeColorHover: v, badgeShadowColor: r, badgeHeightSm: t, badgeDotSize: a / 2, badgeFontSizeSm: a, badgeStatusSize: a / 2, badgeProcessingDuration: "1.2s", badgeRibbonOffset: l, badgeRibbonCornerTransform: "scaleY(0.75)", badgeRibbonCornerFilter: "brightness(75%)" }); return [rt(m)] })); const st = r({ compatConfig: { MODE: 3 }, name: "ABadgeRibbon", inheritAttrs: !1, props: { prefix: String, color: { type: String }, text: b.any, placement: { type: String, default: "end" } }, slots: Object, setup(e, t) { let { attrs: o, slots: a } = t; const { prefixCls: n, direction: l } = g("ribbon", e), [r, s] = it(n), u = i((() => Pe(e.color, !1))), c = i((() => [n.value, `${n.value}-placement-${e.placement}`, { [`${n.value}-rtl`]: "rtl" === l.value, [`${n.value}-color-${e.color}`]: u.value }])); return () => { var t, l; const { class: i, style: d } = o, m = function (e, t) { var o = {}; for (var a in e) Object.prototype.hasOwnProperty.call(e, a) && t.indexOf(a) < 0 && (o[a] = e[a]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var n = 0; for (a = Object.getOwnPropertySymbols(e); n < a.length; n++)t.indexOf(a[n]) < 0 && Object.prototype.propertyIsEnumerable.call(e, a[n]) && (o[a[n]] = e[a[n]]) } return o }(o, ["class", "style"]), g = {}, h = {}; return e.color && !u.value && (g.background = e.color, h.color = e.color), r(v("div", S({ class: `${n.value}-wrapper ${s.value}` }, m), [null === (t = a.default) || void 0 === t ? void 0 : t.call(a), v("div", { class: [c.value, i, s.value], style: p(p({}, g), d) }, [v("span", { class: `${n.value}-text` }, [e.text || (null === (l = a.text) || void 0 === l ? void 0 : l.call(a))]), v("div", { class: `${n.value}-corner`, style: h }, null)])])) } } }), ut = r({ compatConfig: { MODE: 3 }, name: "ABadge", Ribbon: st, inheritAttrs: !1, props: { count: b.any.def(null), showZero: { type: Boolean, default: void 0 }, overflowCount: { type: Number, default: 99 }, dot: { type: Boolean, default: void 0 }, prefixCls: String, scrollNumberPrefixCls: String, status: { type: String }, size: { type: String, default: "default" }, color: String, text: b.any, offset: Array, numberStyle: { type: Object, default: void 0 }, title: String }, slots: Object, setup(e, t) { let { slots: o, attrs: a } = t; const { prefixCls: n, direction: l } = g("badge", e), [r, s] = it(n), d = i((() => e.count > e.overflowCount ? `${e.overflowCount}+` : e.count)), h = i((() => "0" === d.value || 0 === d.value)), b = i((() => null === e.count || h.value && !e.showZero)), y = i((() => (null !== e.status && void 0 !== e.status || null !== e.color && void 0 !== e.color) && b.value)), w = i((() => e.dot && !h.value)), k = i((() => w.value ? "" : d.value)), C = i((() => (null === k.value || void 0 === k.value || "" === k.value || h.value && !e.showZero) && !w.value)), D = u(e.count), E = u(k.value), A = u(w.value); c([() => e.count, k, w], (() => { C.value || (D.value = e.count, E.value = k.value, A.value = w.value) }), { immediate: !0 }); const j = i((() => Pe(e.color, !1))), z = i((() => ({ [`${n.value}-status-dot`]: y.value, [`${n.value}-status-${e.status}`]: !!e.status, [`${n.value}-color-${e.color}`]: j.value }))), L = i((() => e.color && !j.value ? { background: e.color, color: e.color } : {})), R = i((() => ({ [`${n.value}-dot`]: A.value, [`${n.value}-count`]: !A.value, [`${n.value}-count-sm`]: "small" === e.size, [`${n.value}-multiple-words`]: !A.value && E.value && E.value.toString().length > 1, [`${n.value}-status-${e.status}`]: !!e.status, [`${n.value}-color-${e.color}`]: j.value }))); return () => { var t, i; const { offset: u, title: c, color: d } = e, g = a.style, h = $(o, e, "text"), b = n.value, w = D.value; let k = x(null === (t = o.default) || void 0 === t ? void 0 : t.call(o)); k = k.length ? k : null; const A = !(C.value && !o.count), q = (() => { if (!u) return p({}, g); const e = { marginTop: Ne(u[1]) ? `${u[1]}px` : u[1] }; return "rtl" === l.value ? e.left = `${parseInt(u[0], 10)}px` : e.right = -parseInt(u[0], 10) + "px", p(p({}, e), g) })(), T = null != c ? c : "string" == typeof w || "number" == typeof w ? w : void 0, H = A || !h ? null : v("span", { class: `${b}-status-text` }, [h]), M = "object" == typeof w || void 0 === w && o.count ? f(null != w ? w : null === (i = o.count) || void 0 === i ? void 0 : i.call(o), { style: q }, !1) : null, P = m(b, { [`${b}-status`]: y.value, [`${b}-not-a-wrapper`]: !k, [`${b}-rtl`]: "rtl" === l.value }, a.class, s.value); if (!k && y.value) { const e = q.color; return r(v("span", S(S({}, a), {}, { class: P, style: q }), [v("span", { class: z.value, style: L.value }, null), v("span", { style: { color: e }, class: `${b}-status-text` }, [h])])) } const F = I(k ? `${b}-zoom` : "", { appear: !1 }); let N = p(p({}, q), e.numberStyle); return d && !j.value && (N = N || {}, N.background = d), r(v("span", S(S({}, a), {}, { class: P }), [k, v(O, F, { default: () => [_(v(Je, { prefixCls: e.scrollNumberPrefixCls, show: A, class: R.value, count: E.value, title: T, style: N, key: "scrollNumber" }, { default: () => [M] }), [[B, A]])] }), H])) } } }); ut.install = function (e) { return e.component(ut.name, ut), e.component(st.name, st), e }; var ct = { icon: { tag: "svg", attrs: { viewBox: "64 64 896 896", focusable: "false" }, children: [{ tag: "path", attrs: { d: "M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z" } }] }, name: "file-text", theme: "outlined" }; function dt(e) { for (var t = 1; t < arguments.length; t++) { var o = null != arguments[t] ? Object(arguments[t]) : {}, a = Object.keys(o); "function" == typeof Object.getOwnPropertySymbols && (a = a.concat(Object.getOwnPropertySymbols(o).filter((function (e) { return Object.getOwnPropertyDescriptor(o, e).enumerable })))), a.forEach((function (t) { pt(e, t, o[t]) })) } return e } function pt(e, t, o) { return t in e ? Object.defineProperty(e, t, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = o, e } var vt = function (e, t) { var o = dt({}, e, t.attrs); return v(D, dt({}, o, { icon: ct }), null) }; vt.displayName = "FileTextOutlined", vt.inheritAttrs = !1; const mt = () => ({ prefixCls: String, description: b.any, type: E("default"), shape: E("circle"), tooltip: b.any, href: String, target: String, badge: A(), onClick: j() }), gt = r({ compatConfig: { MODE: 3 }, name: "AFloatButtonContent", inheritAttrs: !1, props: { prefixCls: E() }, setup(e, t) { let { attrs: o, slots: a } = t; return () => { var t; const { prefixCls: n } = e, l = h(null === (t = a.description) || void 0 === t ? void 0 : t.call(a)); return v("div", S(S({}, o), {}, { class: [o.class, `${n}-content`] }), [a.icon || l.length ? v(L, null, [a.icon && v("div", { class: `${n}-icon` }, [a.icon()]), l.length ? v("div", { class: `${n}-description` }, [l]) : null]) : v("div", { class: `${n}-icon` }, [v(vt, null, null)])]) } } }), ht = Symbol("floatButtonGroupContext"), ft = () => R(ht, { shape: u() }), bt = e => 0 === e ? 0 : e - Math.sqrt(Math.pow(e, 2) / 2), yt = e => { const { componentCls: t, floatButtonSize: o, motionDurationSlow: a, motionEaseInOutCirc: n } = e, l = `${t}-group`, r = new C("antFloatButtonMoveDownIn", { "0%": { transform: `translate3d(0, ${o}px, 0)`, transformOrigin: "0 0", opacity: 0 }, "100%": { transform: "translate3d(0, 0, 0)", transformOrigin: "0 0", opacity: 1 } }), i = new C("antFloatButtonMoveDownOut", { "0%": { transform: "translate3d(0, 0, 0)", transformOrigin: "0 0", opacity: 1 }, "100%": { transform: `translate3d(0, ${o}px, 0)`, transformOrigin: "0 0", opacity: 0 } }); return [{ [`${l}-wrap`]: p({}, H(`${l}-wrap`, r, i, a, !0)) }, { [`${l}-wrap`]: { [`\n          &${l}-wrap-enter,\n          &${l}-wrap-appear\n        `]: { opacity: 0, animationTimingFunction: n }, [`&${l}-wrap-leave`]: { animationTimingFunction: n } } }] }, wt = e => { const { antCls: t, componentCls: o, floatButtonSize: a, margin: n, borderRadiusLG: l, borderRadiusSM: r, badgeOffset: i, floatButtonBodyPadding: s } = e, u = `${o}-group`; return { [u]: p(p({}, k(e)), { zIndex: 99, display: "block", border: "none", position: "fixed", width: a, height: "auto", boxShadow: "none", minHeight: a, insetInlineEnd: e.floatButtonInsetInlineEnd, insetBlockEnd: e.floatButtonInsetBlockEnd, borderRadius: l, [`${u}-wrap`]: { zIndex: -1, display: "block", position: "relative", marginBottom: n }, [`&${u}-rtl`]: { direction: "rtl" }, [o]: { position: "static" } }), [`${u}-circle`]: { [`${o}-circle:not(:last-child)`]: { marginBottom: e.margin, [`${o}-body`]: { width: a, height: a, borderRadius: "50%" } } }, [`${u}-square`]: { [`${o}-square`]: { borderRadius: 0, padding: 0, "&:first-child": { borderStartStartRadius: l, borderStartEndRadius: l }, "&:last-child": { borderEndStartRadius: l, borderEndEndRadius: l }, "&:not(:last-child)": { borderBottom: `${e.lineWidth}px ${e.lineType} ${e.colorSplit}` }, [`${t}-badge`]: { [`${t}-badge-count`]: { top: -(s + i), insetInlineEnd: -(s + i) } } }, [`${u}-wrap`]: { display: "block", borderRadius: l, boxShadow: e.boxShadowSecondary, [`${o}-square`]: { boxShadow: "none", marginTop: 0, borderRadius: 0, padding: s, "&:first-child": { borderStartStartRadius: l, borderStartEndRadius: l }, "&:last-child": { borderEndStartRadius: l, borderEndEndRadius: l }, "&:not(:last-child)": { borderBottom: `${e.lineWidth}px ${e.lineType} ${e.colorSplit}` }, [`${o}-body`]: { width: e.floatButtonBodySize, height: e.floatButtonBodySize } } } }, [`${u}-circle-shadow`]: { boxShadow: "none" }, [`${u}-square-shadow`]: { boxShadow: e.boxShadowSecondary, [`${o}-square`]: { boxShadow: "none", padding: s, [`${o}-body`]: { width: e.floatButtonBodySize, height: e.floatButtonBodySize, borderRadius: r } } } } }, kt = e => { const { antCls: t, componentCls: o, floatButtonBodyPadding: a, floatButtonIconSize: n, floatButtonSize: l, borderRadiusLG: r, badgeOffset: i, dotOffsetInSquare: s, dotOffsetInCircle: u } = e; return { [o]: p(p({}, k(e)), { border: "none", position: "fixed", cursor: "pointer", zIndex: 99, display: "block", justifyContent: "center", alignItems: "center", width: l, height: l, insetInlineEnd: e.floatButtonInsetInlineEnd, insetBlockEnd: e.floatButtonInsetBlockEnd, boxShadow: e.boxShadowSecondary, "&-pure": { position: "relative", inset: "auto" }, "&:empty": { display: "none" }, [`${t}-badge`]: { width: "100%", height: "100%", [`${t}-badge-count`]: { transform: "translate(0, 0)", transformOrigin: "center", top: -i, insetInlineEnd: -i } }, [`${o}-body`]: { width: "100%", height: "100%", display: "flex", justifyContent: "center", alignItems: "center", transition: `all ${e.motionDurationMid}`, [`${o}-content`]: { overflow: "hidden", textAlign: "center", minHeight: l, display: "flex", flexDirection: "column", justifyContent: "center", alignItems: "center", padding: `${a / 2}px ${a}px`, [`${o}-icon`]: { textAlign: "center", margin: "auto", width: n, fontSize: n, lineHeight: 1 } } } }), [`${o}-rtl`]: { direction: "rtl" }, [`${o}-circle`]: { height: l, borderRadius: "50%", [`${t}-badge`]: { [`${t}-badge-dot`]: { top: u, insetInlineEnd: u } }, [`${o}-body`]: { borderRadius: "50%" } }, [`${o}-square`]: { height: "auto", minHeight: l, borderRadius: r, [`${t}-badge`]: { [`${t}-badge-dot`]: { top: s, insetInlineEnd: s } }, [`${o}-body`]: { height: "auto", borderRadius: r } }, [`${o}-default`]: { backgroundColor: e.floatButtonBackgroundColor, transition: `background-color ${e.motionDurationMid}`, [`${o}-body`]: { backgroundColor: e.floatButtonBackgroundColor, transition: `background-color ${e.motionDurationMid}`, "&:hover": { backgroundColor: e.colorFillContent }, [`${o}-content`]: { [`${o}-icon`]: { color: e.colorText }, [`${o}-description`]: { display: "flex", alignItems: "center", lineHeight: `${e.fontSizeLG}px`, color: e.colorText, fontSize: e.fontSizeSM } } } }, [`${o}-primary`]: { backgroundColor: e.colorPrimary, [`${o}-body`]: { backgroundColor: e.colorPrimary, transition: `background-color ${e.motionDurationMid}`, "&:hover": { backgroundColor: e.colorPrimaryHover }, [`${o}-content`]: { [`${o}-icon`]: { color: e.colorTextLightSolid }, [`${o}-description`]: { display: "flex", alignItems: "center", lineHeight: `${e.fontSizeLG}px`, color: e.colorTextLightSolid, fontSize: e.fontSizeSM } } } } } }, Ct = y("FloatButton", (e => { const { colorTextLightSolid: t, colorBgElevated: o, controlHeightLG: a, marginXXL: n, marginLG: l, fontSize: r, fontSizeIcon: i, controlItemBgHover: s, paddingXXS: u, borderRadiusLG: c } = e, d = w(e, { floatButtonBackgroundColor: o, floatButtonColor: t, floatButtonHoverBackgroundColor: s, floatButtonFontSize: r, floatButtonIconSize: 1.5 * i, floatButtonSize: a, floatButtonInsetBlockEnd: n, floatButtonInsetInlineEnd: l, floatButtonBodySize: a - 2 * u, floatButtonBodyPadding: u, badgeOffset: 1.5 * u, dotOffsetInCircle: bt(a / 2), dotOffsetInSquare: bt(c) }); return [wt(d), kt(d), T(e), yt(d)] })); const St = "float-btn", $t = r({ compatConfig: { MODE: 3 }, name: "AFloatButton", inheritAttrs: !1, props: M(mt(), { type: "default", shape: "circle" }), setup(e, t) { let { attrs: o, slots: a } = t; const { prefixCls: n, direction: l } = g(St, e), [r, s] = Ct(n), { shape: c } = ft(), d = u(null), p = i((() => (null == c ? void 0 : c.value) || e.shape)); return () => { var t; const { prefixCls: i, type: u = "default", shape: c = "circle", description: g = (null === (t = a.description) || void 0 === t ? void 0 : t.call(a)), tooltip: h, badge: f = {} } = e, b = function (e, t) { var o = {}; for (var a in e) Object.prototype.hasOwnProperty.call(e, a) && t.indexOf(a) < 0 && (o[a] = e[a]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var n = 0; for (a = Object.getOwnPropertySymbols(e); n < a.length; n++)t.indexOf(a[n]) < 0 && Object.prototype.propertyIsEnumerable.call(e, a[n]) && (o[a[n]] = e[a[n]]) } return o }(e, ["prefixCls", "type", "shape", "description", "tooltip", "badge"]), y = m(n.value, `${n.value}-${u}`, `${n.value}-${p.value}`, { [`${n.value}-rtl`]: "rtl" === l.value }, o.class, s.value), w = v(Fe, { placement: "left" }, { title: a.tooltip || h ? () => a.tooltip && a.tooltip() || h : void 0, default: () => v(ut, f, { default: () => [v("div", { class: `${n.value}-body` }, [v(gt, { prefixCls: n.value }, { icon: a.icon, description: () => g })])] }) }); return r(e.href ? v("a", S(S(S({ ref: d }, o), b), {}, { class: y }), [w]) : v("button", S(S(S({ ref: d }, o), b), {}, { class: y, type: "button" }), [w])) } } }), xt = r({ compatConfig: { MODE: 3 }, name: "AFloatButtonGroup", inheritAttrs: !1, props: M(p(p({}, mt()), { trigger: E(), open: z(), onOpenChange: j(), "onUpdate:open": j() }), { type: "default", shape: "circle" }), setup(e, t) { let { attrs: o, slots: a, emit: n } = t; const { prefixCls: l, direction: r } = g(St, e), [s, d] = Ct(l), [p, h] = Ve(!1, { value: i((() => e.open)) }), f = u(null), b = u(null); (e => { q(ht, e) })({ shape: i((() => e.shape)) }); const y = { onMouseenter() { var t; h(!0), n("update:open", !0), null === (t = e.onOpenChange) || void 0 === t || t.call(e, !0) }, onMouseleave() { var t; h(!1), n("update:open", !1), null === (t = e.onOpenChange) || void 0 === t || t.call(e, !1) } }, w = i((() => "hover" === e.trigger ? y : {})), k = t => { var o, a, l; (null === (o = f.value) || void 0 === o ? void 0 : o.contains(t.target)) ? (null === (a = V(b.value)) || void 0 === a ? void 0 : a.contains(t.target)) && (() => { var t; const o = !p.value; n("update:open", o), null === (t = e.onOpenChange) || void 0 === t || t.call(e, o), h(o) })() : (h(!1), n("update:open", !1), null === (l = e.onOpenChange) || void 0 === l || l.call(e, !1)) }; return c(i((() => e.trigger)), (e => { P() && (document.removeEventListener("click", k), "click" === e && document.addEventListener("click", k)) }), { immediate: !0 }), F((() => { document.removeEventListener("click", k) })), () => { var t; const { shape: n = "circle", type: i = "default", tooltip: u, description: c, trigger: g } = e, h = `${l.value}-group`, y = m(h, d.value, o.class, { [`${h}-rtl`]: "rtl" === r.value, [`${h}-${n}`]: n, [`${h}-${n}-shadow`]: !g }), k = m(d.value, `${h}-wrap`), C = I(`${h}-wrap`); return s(v("div", S(S({ ref: f }, o), {}, { class: y }, w.value), [g && ["click", "hover"].includes(g) ? v(L, null, [v(O, C, { default: () => [_(v("div", { class: k }, [a.default && a.default()]), [[B, p.value]])] }), v($t, { ref: b, type: i, shape: n, tooltip: u, description: c }, { icon: () => { var e, t; return p.value ? (null === (e = a.closeIcon) || void 0 === e ? void 0 : e.call(a)) || v(N, null, null) : (null === (t = a.icon) || void 0 === t ? void 0 : t.call(a)) || v(vt, null, null) }, tooltip: a.tooltip, description: a.description })]) : null === (t = a.default) || void 0 === t ? void 0 : t.call(a)])) } } }); var It = { icon: { tag: "svg", attrs: { viewBox: "64 64 896 896", focusable: "false" }, children: [{ tag: "path", attrs: { d: "M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z" } }] }, name: "vertical-align-top", theme: "outlined" }; function Ot(e) { for (var t = 1; t < arguments.length; t++) { var o = null != arguments[t] ? Object(arguments[t]) : {}, a = Object.keys(o); "function" == typeof Object.getOwnPropertySymbols && (a = a.concat(Object.getOwnPropertySymbols(o).filter((function (e) { return Object.getOwnPropertyDescriptor(o, e).enumerable })))), a.forEach((function (t) { _t(e, t, o[t]) })) } return e } function _t(e, t, o) { return t in e ? Object.defineProperty(e, t, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : e[t] = o, e } var Bt = function (e, t) { var o = Ot({}, e, t.attrs); return v(D, Ot({}, o, { icon: It }), null) }; Bt.displayName = "VerticalAlignTopOutlined", Bt.inheritAttrs = !1; const Dt = r({ compatConfig: { MODE: 3 }, name: "ABackTop", inheritAttrs: !1, props: M(p(p({}, mt()), { prefixCls: String, duration: Number, target: j(), visibilityHeight: Number, onClick: j() }), { visibilityHeight: 400, target: () => window, duration: 450, type: "default", shape: "circle" }), setup(e, t) { let { slots: o, attrs: a, emit: n } = t; const { prefixCls: l, direction: r } = g(St, e), [i] = Ct(l), d = u(), m = s({ visible: 0 === e.visibilityHeight, scrollEvent: null }), h = () => d.value && d.value.ownerDocument ? d.value.ownerDocument : window, f = t => { const { target: o = h, duration: a } = e; Qe(0, { getContainer: o, duration: a }), n("click", t) }, b = Ze((t => { const { visibilityHeight: o } = e, a = Ke(t.target); m.visible = a >= o })), y = () => { const { target: t } = e, o = (t || h)(); b({ target: o }), null == o || o.addEventListener("scroll", b) }, w = () => { const { target: t } = e, o = (t || h)(); b.cancel(), null == o || o.removeEventListener("scroll", b) }; c((() => e.target), (() => { w(), W((() => { y() })) })), Q((() => { W((() => { y() })) })), K((() => { W((() => { y() })) })), U((() => { w() })), F((() => { w() })); const k = ft(); return () => { const { description: t, type: n, shape: s, tooltip: u, badge: c } = e, g = p(p({}, a), { shape: (null == k ? void 0 : k.shape.value) || s, onClick: f, class: { [`${l.value}`]: !0, [`${a.class}`]: a.class, [`${l.value}-rtl`]: "rtl" === r.value }, description: t, type: n, tooltip: u, badge: c }), h = I("fade"); return i(v(O, h, { default: () => [_(v($t, S(S({}, g), {}, { ref: d }), { icon: () => { var e; return (null === (e = o.icon) || void 0 === e ? void 0 : e.call(o)) || v(Bt, null, null) } }), [[B, m.visible]])] })) } } }); $t.Group = xt, $t.BackTop = Dt, $t.install = function (e) { return e.component($t.name, $t), e.component(xt.name, xt), e.component(Dt.name, Dt), e }; const Et = { class: "upload-box" }, At = (e => (ee("data-v-ec2d7664"), e = e(), te(), e))((() => X("img", { class: "icon-file", src: "/qanything/assets/icon-file-Bxz0aRpP.png", alt: "图标" }, null, -1))), jt = { class: "title" }, zt = { class: "desc-content" }, Lt = { class: "desc" }, Rt = { class: "desc" }, qt = oe(r({ __name: "UploadDom", props: { acceptList: { require: !0, type: Array, default: () => [] } }, emits: ["update"], setup(e, { emit: t }) { const o = a().home, n = t, l = () => { n("update") }; return (e, t) => (Z(), G("div", Et, [X("div", { class: "tips", onClick: l }, [At, X("p", jt, Y(J(o).startDec), 1), X("div", zt, [X("p", Lt, Y(J(o).updesc2), 1), X("p", Rt, Y(J(o).require1), 1)])])])) } }), [["__scopeId", "data-v-ec2d7664"]]), Tt = { class: "default" }, Ht = { class: "box" }, Mt = { class: "title" }, Pt = (e => (ee("data-v-48fad799"), e = e(), te(), e))((() => X("span", null, " ", -1))), Ft = { class: "color" }, Nt = { class: "desc" }, Vt = oe(r({ __name: "Defaultpage", setup(t) { const o = a().home, { setFileList: n } = fe(), { setModalVisible: l } = fe(), { setCurrentId: r, getList: i, setCurrentKbName: s } = e(), c = [".md", ".txt", ".pdf", ".jpg", ".png", ".jpeg", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".jsonl", ".eml", ".csv"], d = u(""), p = async () => { try { const e = await ye.createKb({ kb_name: o.defaultName }); 200 == +e.code && (d.value = e.data.kb_id, r(e.data.kb_id), s(e.kb_name), l(!0), i()) } catch (e) { n([]), ae.error(e.msg) } }; return (e, t) => (Z(), G("div", Tt, [X("div", Ht, [X("p", Mt, [X("span", null, Y(J(o).homeTitle1), 1), Pt, X("span", Ft, Y(J(o).homeTitle2), 1)]), X("p", Nt, Y(J(o).defaultDec), 1), v(qt, { "accept-list": c, onUpdate: p })])])) } }), [["__scopeId", "data-v-48fad799"]]), Wt = ne("useHomeChat", (() => { const e = u([]), t = u([]), o = e => { t.value = e }, a = u([]), n = u(null), l = u(1), r = u(1); return { QA_List: e, setQaList: t => { e.value = t }, historyList: t, addHistoryList: e => { var a; const n = ((null == (a = t.value.at(-1)) ? void 0 : a.historyId) || 0) + 1, l = { historyId: n, title: e }, r = [...t.value, l]; return o(r), n }, deleteHistoryList: e => { const a = t.value.filter((t => t.historyId !== e)); o(a) }, updateHistoryList: (e, a, n) => { const l = t.value.map((t => (t.historyId === a && (t.title = e, t.kbIds = n), t))); o(l) }, chatList: a, addChatList: (e, t) => { const o = { historyId: e, list: t }; a.value.some((t => t.historyId === e)) ? a.value.forEach((o => { o.historyId === e && (o.list = t) })) : a.value.push(o) }, getChatById: e => a.value.filter((t => t.historyId === e))[0], clearChatList: e => { a.value = a.value.filter((t => t.historyId !== e)), t.value = t.value.filter((t => t.historyId !== e)) }, chatId: n, setChatId: e => { n.value = e }, pageId: l, setPageId: e => { l.value = e }, qaPageId: r, setQaPageId: e => { r.value = e } } }), { persist: { storage: localStorage } }), Qt = { class: "history-chat" }, Kt = { class: "history-chat-content" }, Ut = { class: "list" }, Zt = (e => (ee("data-v-b9aad642"), e = e(), te(), e))((() => X("div", { class: "line" }, null, -1))), Gt = ["onClick"], Xt = ["onClick"], Yt = oe(r({ __name: "HistoryChat", props: { observer: { type: Object, required: !0 }, observeDom: { type: Object, default: null }, qaObserver: { type: Object, required: !0 }, qaObserveDom: { type: Object, default: null }, showLoading: { type: Boolean, require: !0 } }, emits: ["scrollBottom", "setObserveDom", "setQaObserverDom", "clearHistory"], setup(t, { emit: o }) { const n = t, { chatList: l, chatId: r, QA_List: i, qaPageId: s, pageId: u, historyList: c } = le(Wt()), { deleteHistoryList: d, getChatById: p } = Wt(), { setSelectList: m } = e(), g = o; async function h(e) { if (!n.showLoading) { r.value = e.historyId, i.value = [], s.value = 1, m([...e.kbIds]), g("clearHistory"); try { const e = p(r.value); null !== n.qaObserveDom && (n.qaObserver.unobserve(n.qaObserveDom), g("setQaObserverDom", null)), e.list.forEach((e => { var t, o, a, n, l, r, s; "user" === e.type ? (s = e.question, i.value.push({ question: s, type: "user" })) : "ai" === e.type && (t = e.question, o = e.itemInfo, a = e.answer, n = e.picList, l = e.qaId, r = e.source, i.value.push({ answer: a, question: t, itemInfo: o, type: "ai", qaId: l, copied: !1, like: !1, unlike: !1, source: r || [], showTools: !0, picList: n })) })), g("scrollBottom"), e.list.length >= 50 && await W((() => { const e = document.getElementsByClassName("chat-li"); e.length && (n.qaObserver.observe(e[0]), g("setQaObserverDom", e[0])) })) } catch (t) { ae.error(t.msg || "获取问答历史失败") } } } function f() { n.showLoading || (null !== r.value ? (r.value = null, i.value = [], s.value = 1, u.value = 1, g("clearHistory")) : ae.info("已切换最新对话")) } async function b(e, t) { if (!n.showLoading) try { d(e.historyId), e.historyId === r.value && f(), ae.success("删除成功"), l.value.splice(t, 1), await W((() => { !function () { if (null !== n.qaObserveDom) { n.qaObserver.unobserve(n.qaObserveDom), g("setQaObserverDom", null); const e = document.getElementsByClassName("chat-li"); e.length && (n.qaObserver.observe(e[0]), g("setQaObserverDom", e[0])) } }() })) } catch (o) { ae.error(o.msg || "删除失败") } } return (e, o) => (Z(), G("div", Qt, [X("div", Kt, [X("div", Ut, [X("div", { class: re(["new-chat", [t.showLoading ? "disabled" : "", null === J(r) ? "new-active" : ""]]), onClick: f }, [v(ie, { name: "new-chat" }), se(" " + Y(J(a)().home.newConversation), 1)], 2), (Z(!0), G(L, null, ue(J(c), ((e, o) => (Z(), G("div", { key: e.historyId, class: re(["chat-item", J(r) === e.historyId ? "item-active" : "", t.showLoading ? "disabled" : ""]) }, [Zt, X("span", { onClick: t => h(e) }, Y(e.title), 9, Gt), J(r) === e.historyId ? (Z(), G("img", { key: 0, src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAEgSURBVFiF7ZaxDcJADEVt0lAyQkaAKzIHI0BxkmeKCxiFAaKDDRAdJQvkQpNIEeQu9gVoyK8SXZz/ZPssA8ya9e/KYofW2nVRFMuqqh4pP5fEL0IHRJQj4tl7f7XW7hLMd734tRqgrutV94yIBw1Ea37o3rMsC2YgWALn3N0Yc0PEbQuxNcbcnHMXjXnTNPuyLE9qgBbiooEYMmfmY8wjCqCBSDEXAUggUs0BAFDyUachoxYoyVwNMATRl9YcQFiCvl7LMcUcIDIHfiV1BkIlkM6Jt7gp5p9oQnEGQldNO6ySAMbu+RSIUQDpkEmFGNsHVBMuBSLYhESUe++vUvMR8A0zD0KI9gFtZzPzsbshAPF9ICoiymPbzLfjZ836Dz0BusANDR+zFvgAAAAASUVORK5CYII=", class: "close-icon", alt: "close", onClick: t => b(e, o) }, null, 8, Xt)) : ce("", !0)], 2)))), 128))])])])) } }), [["__scopeId", "data-v-b9aad642"]]), Jt = e => (ee("data-v-04841235"), e = e(), te(), e), eo = { class: "container showSider" }, to = { class: "my-page" }, oo = { key: 0, class: "user" }, ao = Jt((() => X("img", { class: "avatar", src: Ee, alt: "头像" }, null, -1))), no = { class: "question-text" }, lo = { key: 1, class: "ai" }, ro = Jt((() => X("img", { class: "avatar", src: Ae, alt: "头像" }, null, -1))), io = { class: "ai-content" }, so = { class: "ai-right" }, uo = { key: 0 }, co = { key: 1 }, po = { class: "source-list" }, vo = { class: "control" }, mo = { class: "tips" }, go = ["href"], ho = ["onClick"], fo = { class: "source-content" }, bo = { class: "score" }, yo = { class: "tips" }, wo = { class: "tips" }, ko = ["onClick"], Co = { key: 1, class: "feed-back" }, So = ["onClick"], $o = { class: "reload-text" }, xo = { class: "tools" }, Io = { key: 0, class: "stop-btn" }, Oo = { class: "question-box" }, _o = { class: "question" }, Bo = { class: "send-box" }, Do = { class: "send-action" }, Eo = oe(r({ __name: "Chat", setup(o) { const { common: l } = a(), r = new je((e => { e && (d.value[d.value.length - 1].answer += e || "") })), { selectList: s, knowledgeBaseList: c } = le(e()), { QA_List: d, chatId: p, pageId: m, qaPageId: g, historyList: h } = le(Wt()), { chatSettingFormActive: f } = le(qe()), { addHistoryList: b, updateHistoryList: y, addChatList: w, clearChatList: k } = Wt(), { setCopyUrlVisible: C, setWebUrl: S } = Te(), { language: $ } = le(n()), { like: x, unlike: I, copy: D, deleteChatItem: E } = Le(), { handleChatSourceBlank: A, checkFileType: j, handleChatSourceChunk: z } = t(), R = u(""), q = i((() => { const e = f.value.context; if (0 === e) return []; const t = d.value.filter((e => "ai" === e.type)); return (11 === e ? t : t.slice(-e)).map((e => [e.question, e.answer.replace(/<think>([\s\S]*?)<\/think>/g, "").replace(/<response>/g, "").replace(/<\/response>/g, "")])) })), T = u(!1), H = u([]), M = u(null), P = u(null); let N; const V = u(null), K = u(null), U = () => { W((() => { var e; null == (e = K.value) || e.scrollIntoView({ behavior: "smooth", block: "end" }) })) }, ee = new IntersectionObserver((e => { e.forEach((e => { e.isIntersecting && m.value++ })) })), te = new IntersectionObserver((e => { e.forEach((e => { e.isIntersecting && g.value++ })) })); Q((() => { U() })), F((() => { M.value && ee.unobserve(M.value), P.value && te.unobserve(P.value) })); const oe = e => { d.value.push({ answer: "", question: e, onlySearch: f.value.capabilities.onlySearch, type: "ai", copied: !1, like: !1, unlike: !1, source: [], showTools: !1, qaId: "", showModelInfo: f.value.answerSetting.showModelInfo }) }, ne = new xe, fe = e => { M.value = e }, Ee = e => { P.value = e }, Ae = (e, t, o) => { try { y(e, t, o) } catch (a) { ae.error(a.msg || "更新对话失败") } }; const Me = () => { N && N.abort("停止对话"), r.done(), T.value = !1, d.value[d.value.length - 1].showTools = !0 }, Pe = async () => { if (!R.value.trim().length) return; if (T.value) return void ae.warn("正在聊天中...请等待结束"); if (!(await Je())) return void ae.error("模型设置错误，请先检查模型配置"); if (!((R.value.match(/@/g) || []).length <= 10)) return void ae.error("不可@超过10个"); if (function () { if (!s.value.length) return; const e = []; s.value.forEach((t => { c.value.some((e => e.kb_id === t)) && e.push(t) })), s.value = e, h.value.forEach((e => { null !== p.value && e.historyId === p.value && e.kbIds.join("") !== s.value.join("") && Ae(e.title, e.historyId, s.value) })) }(), !s.value.length) return ae.warning(l.chooseError); ae.info({ content: "zh" === l.type ? `已选择 ${s.value.length} 个知识库进行问答` : ` ${s.value.length} knowledge base has been selected`, icon: " " }); const e = R.value; (e => { try { if (null !== p.value) return; e.length > 100 && (e = e.substring(0, 100)), p.value = b(e), Ae(e, p.value, s.value) } catch (t) { ae.error(t.msg || "创建对话失败") } })(e), R.value = "", (e => { d.value.push({ question: e, type: "user" }), U() })(e), w(p.value, d.value), T.value = !0, N = new AbortController; const t = { kb_ids: s.value, history: q.value, question: e, streaming: !1 === f.value.capabilities.onlySearch, networking: f.value.capabilities.networkSearch, product_source: "saas", only_need_search_results: f.value.capabilities.onlySearch, multi_rerank: f.value.capabilities.multiRerank, graph_retriever: f.value.capabilities.graphRetriever, max_token: f.value.maxToken, api_base: f.value.apiBase, api_key: f.value.apiKey, model: f.value.apiModelName, api_context_length: f.value.apiContextLength, chunk_size: f.value.chunkSize, top_p: f.value.top_P, top_k: f.value.top_K, temperature: f.value.temperature, rerank_score: f.value.rerankScoreThreshold, show_model_info: f.value.answerSetting.showModelInfo, show_warning: f.value.answerSetting.showWarning, answer_type: f.value.answerType }; if (f.value.capabilities.onlySearch) { ne.addChatSetting(f.value), oe(e); try { const e = await we(await ye.sendQuestion(t, { signal: N.signal })); 200 === e.code && (d.value[d.value.length - 1].answer = (null == e ? void 0 : e.source_documents.length) ? l.searchCompleted : l.searchNotFound, d.value[d.value.length - 1].source = null == e ? void 0 : e.source_documents) } catch (o) { d.value[d.value.length - 1].answer = o.msg || "error" } T.value = !1, d.value[d.value.length - 1].showTools = !0, w(p.value, d.value), await W((() => { U() })) } else Be(Se + "/rag/local_doc_chat", { method: "POST", headers: { "Content-Type": "application/json", Accept: ["text/event-stream", "application/json"] }, openWhenHidden: !0, body: JSON.stringify({ user_id: ke, user_info: Ce, ...t }), signal: N.signal, onopen(t) { oe(e), t.ok && "text/event-stream" === t.headers.get("content-type") ? (ne.addChatSetting(f.value), r.start()) : "application/json" === t.headers.get("content-type") && r.add("Error 请检查模型是否配置正确") }, onmessage(e) { var t, o; const a = JSON.parse(e.data); if (200 == (null == a ? void 0 : a.code) && (null == a ? void 0 : a.response) && "success" === a.msg) r.add(null == a ? void 0 : a.response), U(); else { delete a.time_record.time_usage.retriever_search_by_milvus, ne.addTime(a.time_record.time_usage), ne.addToken(a.time_record.token_usage), ne.addDate(Date.now()), d.value[d.value.length - 1].qaId = null == a ? void 0 : a.qa_id } (null == (t = null == a ? void 0 : a.source_documents) ? void 0 : t.length) && (d.value[d.value.length - 1].source = null == a ? void 0 : a.source_documents), (null == (o = null == a ? void 0 : a.show_images) ? void 0 : o.length) && (null == a || a.show_images.map((e => { if (e.startsWith("![]")) { const t = 500; e.match(new RegExp(".{1," + t + "}", "g")).forEach((e => { r.add(e) })) } else r.add(e) }))) }, onclose(e) { r.done(), N.abort(), T.value = !1, d.value[d.value.length - 1].showTools = !0, d.value.at(-1).itemInfo = ne.getChatInfo(), w(p.value, d.value), W((() => { U() })) }, onerror(e) { throw null == r || r.done(), null == N || N.abort(), T.value = !1, d.value[d.value.length - 1].showTools = !0, ae.error(e.msg || "出错了"), w(p.value, d.value), W((() => { U() })), e } }) }, Fe = async () => { if (0 !== s.value.length) try { const { bot_id: e } = await we(await ye.createBot({ bot_name: "bot-" + $e(Date.now()), description: "来源: 知识库创建-" + $e(Date.now()) })); await we(await ye.updateBot({ bot_id: e, kb_ids: [...s.value], only_need_search_results: f.value.capabilities.onlySearch, networking: f.value.capabilities.networkSearch, multi_rerank: f.value.capabilities.multiRerank, graph_retriever: f.value.capabilities.graphRetriever, api_base: f.value.apiBase, api_key: f.value.apiKey, api_context_length: f.value.apiContextLength, top_p: f.value.top_P, temperature: f.value.temperature, top_k: f.value.top_K, model: f.value.apiModelName, max_token: f.value.maxToken, chunk_size: f.value.chunkSize, rerank_score: f.value.rerankScoreThreshold, show_model_info: f.value.answerSetting.showModelInfo, show_warning: f.value.answerSetting.showWarning, answer_type: f.value.answerType })), C(!0); const { origin: t, pathname: o } = window.location; S(`${t + o}#/bots/${e}/share`) } catch (e) { ae.error((null == e ? void 0 : e.msg) || "分享失败") } }, { showModal: Ne } = le(Ie()), Ve = u(!1), Qe = u(""), Ke = u(""), Ue = () => { T.value || (Ke.value = "download", Ne.value = !0, Qe.value = l.saveTip) }, Ze = () => { T.value || (Ke.value = "delete", Ne.value = !0, Qe.value = l.clearTip) }, Ge = async () => { if (Ve.value = !0, "download" === Ke.value) try { const e = document.getElementById("chat-ul"), t = (await De(e, { useCORS: !0 })).toDataURL("image/png"), o = document.createElement("a"); o.style.display = "none", o.href = t, o.setAttribute("download", "chat-shot.png"), void 0 === o.download && o.setAttribute("target", "_blank"), document.body.appendChild(o), o.click(), document.body.removeChild(o), window.URL.revokeObjectURL(t), ae.success("下载成功"), Promise.resolve() } catch (e) { ae.error(e.message || e.msg || "出错了") } else "delete" === Ke.value && (k(p.value), p.value = null, d.value = []); Ke.value = "", Qe.value = "", Ve.value = !1, Ne.value = !1 }, { showSettingModal: Xe } = le(Ie()), Ye = u(), Je = () => Ye.value.handleOk(); function et() { } const tt = e => { 13 === e.keyCode && (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey ? R.value += "\n" : Pe(), e.preventDefault()) }; return (e, t) => { const o = ge, a = he, n = We, r = $t; return Z(), G(L, null, [v(Yt, { observer: J(ee), "observe-dom": J(M), "qa-observe-dom": J(P), "qa-observer": J(te), "show-loading": J(T), onScrollBottom: U, onSetObserveDom: fe, onSetQaObserverDom: Ee, onClearHistory: et }, null, 8, ["observer", "observe-dom", "qa-observe-dom", "qa-observer", "show-loading"]), X("div", eo, [X("div", to, [X("div", { id: "chat", ref_key: "chatContainer", ref: V, class: "chat showSider" }, [X("ul", { id: "chat-ul", ref_key: "scrollDom", ref: K }, [(Z(!0), G(L, null, ue(J(d), ((e, t) => { var o, a; return Z(), G("li", { key: t }, ["user" === e.type ? (Z(), G("div", oo, [ao, X("div", no, Y(e.question), 1)])) : (Z(), G("div", lo, [ro, X("div", io, [X("div", so, [X("p", { class: re(["question-text", [e.source.length || (null == (o = null == e ? void 0 : e.picList) ? void 0 : o.length) ? "" : "change-radius", e.showTools ? "" : "flashing"]]) }, [v(Re, { content: e.answer.toString() }, null, 8, ["content"]), Object.keys((null == (a = null == e ? void 0 : e.itemInfo) ? void 0 : a.tokenInfo) || {}).length && e.showModelInfo ? (Z(), de(Oe, { key: 0, "chat-item-info": e.itemInfo }, null, 8, ["chat-item-info"])) : ce("", !0)], 2), e.source.length ? (Z(), G(L, { key: 0 }, [X("div", { class: re(["source-total", J(H).includes(t) ? "" : "source-total-last"]) }, ["zh" === J($) ? (Z(), G("span", uo, " 找到了" + Y(e.source.length) + "个信息来源： ", 1)) : (Z(), G("span", co, " Found " + Y(e.source.length) + " source of information ", 1)), _(v(ie, { name: "down", onClick: e => (e => { H.value.push(e) })(t) }, null, 8, ["onClick"]), [[B, !J(H).includes(t)]]), _(v(ie, { name: "up", onClick: e => (e => { H.value = H.value.filter((t => t !== e)) })(t) }, null, 8, ["onClick"]), [[B, J(H).includes(t)]])], 2), v(O, { name: "source-list" }, { default: pe((() => [_(X("div", po, [(Z(!0), G(L, null, ue(e.source, ((t, o) => (Z(), G("div", { key: o, class: "data-source" }, [_(X("p", vo, [X("span", mo, Y(J(l).dataSource) + Y(o + 1) + ":", 1), t.file_url.startsWith("http") ? (Z(), G("a", { key: 0, href: t.file_url, target: "_blank" }, Y(t.file_name), 9, go)) : (Z(), G("span", { key: 1, class: re(["file", J(j)(t.file_name) ? "filename-active" : ""]), onClick: e => J(A)(t) }, Y(t.file_name), 11, ho)), _(v(ie, { name: "iconup", onClick: t => ((e, t) => { e.source[t].showDetailDataSource = !1 })(e, o) }, null, 8, ["onClick"]), [[B, t.showDetailDataSource]]), _(v(ie, { name: "icondown", onClick: t => ((e, t) => { e.source[t].showDetailDataSource = !e.source[t].showDetailDataSource })(e, o) }, null, 8, ["onClick"]), [[B, !t.showDetailDataSource]])], 512), [[B, t.file_name]]), v(O, { name: "source-list" }, { default: pe((() => [_(X("div", fo, [v(Re, { content: t.content }, null, 8, ["content"]), X("p", bo, [X("span", yo, Y(J(l).correlation), 1), se(" " + Y(t.score), 1)])], 512), [[B, t.showDetailDataSource]])])), _: 2 }, 1024), X("span", wo, Y(J(l).chunkIndex) + ":", 1), X("span", { class: "filename-active", onClick: e => J(z)(t) }, Y(t.doc_id ? Number(t.doc_id.split("_")[1]) + 1 : t.doc_limit[0] === t.doc_limit[1] ? Number(t.doc_limit[1]) + 1 : t.doc_limit[1] >= 0 ? `${t.doc_limit[0] + 1} 到 ${t.doc_limit[1] + 1}` : "所有片段"), 9, ko)])))), 128))], 512), [[B, J(H).includes(t)]])])), _: 2 }, 1024)], 64)) : ce("", !0), e.showTools ? (Z(), G("div", Co, [X("div", { class: "reload-box", onClick: t => (e => { R.value = e.question, Pe() })(e) }, [v(ie, { name: "reload" }), X("span", $o, Y(J(l).regenerate), 1)], 8, So), X("div", xo, [v(ie, { style: ve({ color: e.copied ? "#4D71FF" : "" }), name: "copy", onClick: t => J(D)(e) }, null, 8, ["style", "onClick"]), v(ie, { style: ve({ color: e.like ? "#4D71FF" : "" }), name: "like", onClick: t => J(x)(e) }, null, 8, ["style", "onClick"]), v(ie, { style: ve({ color: e.unlike ? "#4D71FF" : "" }), name: "unlike", onClick: t => J(I)(e) }, null, 8, ["style", "onClick"]), v(ie, { class: "delete-icon", name: "delete", onClick: t => J(E)(e, J(d)) }, null, 8, ["onClick"])])])) : ce("", !0)])])]))]) })), 128))], 512)], 512), J(T) ? (Z(), G("div", Io, [v(o, { onClick: Me }, { icon: pe((() => [v(ie, { name: "stop", class: re(J(T) ? "loading" : "") }, null, 8, ["class"])])), default: pe((() => [se(" " + Y(J(l).stop), 1)])), _: 1 })])) : ce("", !0), X("div", Oo, [X("div", _o, [X("div", Bo, [v(a, { value: J(R), "onUpdate:value": t[0] || (t[0] = e => me(R) ? R.value = e : null), class: "send-textarea", "max-length": "200", bordered: !1, placeholder: J(l).problemPlaceholder, "auto-size": { minRows: 1, maxRows: 8 }, onKeydown: tt }, null, 8, ["value", "placeholder"]), X("div", Do, [v(n, null, { content: pe((() => [se(Y(J(s).length ? J(l).chatShare : J(l).chatShareNoChatId), 1)])), default: pe((() => [X("span", { class: re(["question-icon", J(T) || !J(s).length ? "isPreventClick" : ""]), onClick: Fe }, [v(ie, { name: "chat-share" })], 2)])), _: 1 }), v(n, { placement: "topLeft" }, { content: pe((() => [se(Y(J(l).chatToPic), 1)])), default: pe((() => [X("span", { class: re(["question-icon", J(T) ? "isPreventClick" : ""]), onClick: Ue }, [v(ie, { name: "chat-download" })], 2)])), _: 1 }), v(n, null, { content: pe((() => [se(Y(J(l).clearChat), 1)])), default: pe((() => [X("span", { class: re(["question-icon", J(T) ? "isPreventClick" : ""]), onClick: Ze }, [v(ie, { name: "chat-delete" })], 2)])), _: 1 }), v(n, null, { content: pe((() => [se(Y(J(l).modelSettingTitle), 1)])), default: pe((() => [X("span", { class: "question-icon", onClick: t[1] || (t[1] = e => { return t = !0, void (Xe.value = t); var t }) }, [v(ie, { name: "chat-setting" })])])), _: 1 }), v(o, { type: "primary", disabled: J(T), shape: "circle", onClick: Pe }, { default: pe((() => [v(ie, { name: "sendplane" })])), _: 1 }, 8, ["disabled"])])])])])]), v(r, { shape: "square", style: { right: "30px", bottom: "130px" }, onClick: U }, { icon: pe((() => [v(J(He))])), _: 1 })]), v(ze, { ref_key: "chatSettingForDialogRef", ref: Ye }, null, 512), v(_e, { content: J(Qe), "confirm-loading": J(Ve), onOk: Ge }, null, 8, ["content", "confirm-loading"]), v(be)], 64) } } }), [["__scopeId", "data-v-04841235"]]), Ao = { class: "page" }, jo = { class: "container" }, zo = { key: 0, class: "initing" }, Lo = oe(r({ __name: "Home", setup(t) { const { showDefault: a } = le(e()), { setDefault: n, getList: l } = e(), r = e => { n(e), l() }; return Q((() => { l() })), (e, t) => (Z(), G("div", Ao, [X("div", jo, [J(a) === J(o).initing ? (Z(), G("div", zo)) : ce("", !0), J(a) === J(o).default ? (Z(), de(Vt, { key: 1, onChange: r })) : J(a) === J(o).normal ? (Z(), de(Eo, { key: 2 })) : J(a) === J(o).optionlist ? (Z(), de(Ue, { key: 3 })) : ce("", !0)])])) } }), [["__scopeId", "data-v-9dc9deec"]]); export { Lo as default };
