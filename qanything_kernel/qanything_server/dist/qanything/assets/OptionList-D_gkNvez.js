import { r as e, ap as t, ab as a, ad as l, ae as s, aq as r, ac as o, ar as i, as as n, at as c, d as u, a as d, _ as p, c as g, h as v, M as f, au as m, i as y, g as h, m as k, a5 as b, a6 as C, u as x, av as w, ai as $, aw as S, ax as A, j as I, w as O, q as D, k as L, y as F, H as _, z as j, n as N, O as E, D as T, e as W, l as z, x as P, N as M, v as R, T as U, A as B, ay as X, Q as q, R as V, E as K, F as Q, an as Z, C as H, X as J, Y } from "./index-BVM7diGR.js"; import { a as G, b as ee, c as te, r as ae, u as le, e as se } from "./urlConfig-5Ad6E0st.js"; import { u as re, p as oe, b as ie, a as ne, L as ce } from "./useKnowledgeBase-DZuffAZO.js"; import { a as ue, u as de, b as pe } from "./useUploadFiles-DjlYc-xX.js"; import { g as ge } from "./index-DAdVxPIc.js"; import { C as ve } from "./LeftOutlined-BC9u9Wti.js"; import { _ as fe } from "./RightOutlined-DtsVRhmk.js"; import { u as me } from "./useChatSetting-CpQu1AXT.js"; import { _ as ye, a as he } from "./index-MUygmPPV.js"; const ke = ["normal", "exception", "active", "success"], be = () => ({ prefixCls: String, type: a(), percent: Number, format: l(), status: a(), showInfo: s(), strokeWidth: Number, strokeLinecap: a(), strokeColor: r(), trailColor: String, width: Number, success: o(), gapDegree: Number, gapPosition: a(), size: i([String, Number, Array]), steps: Number, successPercent: Number, title: String, progressStatus: a() }); function Ce(e) { return !e || e < 0 ? 0 : e > 100 ? 100 : e } function xe(e) { let { success: t, successPercent: a } = e, l = a; return t && "progress" in t && (n(!1, "Progress", "`success.progress` is deprecated. Please use `success.percent` instead."), l = t.progress), t && "percent" in t && (l = t.percent), l } const we = (e, t, a) => { var l, s, r, o; let i = -1, n = -1; if ("step" === t) { const t = a.steps, l = a.strokeWidth; "string" == typeof e || void 0 === e ? (i = "small" === e ? 2 : 14, n = null != l ? l : 8) : "number" == typeof e ? [i, n] = [e, e] : [i = 14, n = 8] = e, i *= t } else if ("line" === t) { const t = null == a ? void 0 : a.strokeWidth; "string" == typeof e || void 0 === e ? n = t || ("small" === e ? 6 : 8) : "number" == typeof e ? [i, n] = [e, e] : [i = -1, n = 8] = e } else "circle" !== t && "dashboard" !== t || ("string" == typeof e || void 0 === e ? [i, n] = "small" === e ? [60, 60] : [120, 120] : "number" == typeof e ? [i, n] = [e, e] : (i = null !== (s = null !== (l = e[0]) && void 0 !== l ? l : e[1]) && void 0 !== s ? s : 120, n = null !== (o = null !== (r = e[0]) && void 0 !== r ? r : e[1]) && void 0 !== o ? o : 120)); return { width: i, height: n } }; const $e = (e, t) => { const { from: a = c.blue, to: l = c.blue, direction: s = ("rtl" === t ? "to left" : "to right") } = e, r = function (e, t) { var a = {}; for (var l in e) Object.prototype.hasOwnProperty.call(e, l) && t.indexOf(l) < 0 && (a[l] = e[l]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var s = 0; for (l = Object.getOwnPropertySymbols(e); s < l.length; s++)t.indexOf(l[s]) < 0 && Object.prototype.propertyIsEnumerable.call(e, l[s]) && (a[l[s]] = e[l[s]]) } return a }(e, ["from", "to", "direction"]); if (0 !== Object.keys(r).length) { return { backgroundImage: `linear-gradient(${s}, ${(e => { let t = []; return Object.keys(e).forEach((a => { const l = parseFloat(a.replace(/%/g, "")); isNaN(l) || t.push({ key: l, value: e[a] }) })), t = t.sort(((e, t) => e.key - t.key)), t.map((e => { let { key: t, value: a } = e; return `${a} ${t}%` })).join(", ") })(r)})` } } return { backgroundImage: `linear-gradient(${s}, ${a}, ${l})` } }, Se = u({ compatConfig: { MODE: 3 }, name: "ProgressLine", inheritAttrs: !1, props: p(p({}, be()), { strokeColor: r(), direction: a() }), setup(e, t) { let { slots: a, attrs: l } = t; const s = d((() => { const { strokeColor: t, direction: a } = e; return t && "string" != typeof t ? $e(t, a) : { backgroundColor: t } })), r = d((() => "square" === e.strokeLinecap || "butt" === e.strokeLinecap ? 0 : void 0)), o = d((() => e.trailColor ? { backgroundColor: e.trailColor } : void 0)), i = d((() => { var t; return null !== (t = e.size) && void 0 !== t ? t : [-1, e.strokeWidth || ("small" === e.size ? 6 : 8)] })), n = d((() => we(i.value, "line", { strokeWidth: e.strokeWidth }))), c = d((() => { const { percent: t } = e; return p({ width: `${Ce(t)}%`, height: `${n.value.height}px`, borderRadius: r.value }, s.value) })), u = d((() => xe(e))), m = d((() => { const { success: t } = e; return { width: `${Ce(u.value)}%`, height: `${n.value.height}px`, borderRadius: r.value, backgroundColor: null == t ? void 0 : t.strokeColor } })), y = { width: n.value.width < 0 ? "100%" : n.value.width, height: `${n.value.height}px` }; return () => { var t; return g(f, null, [g("div", v(v({}, l), {}, { class: [`${e.prefixCls}-outer`, l.class], style: [l.style, y] }), [g("div", { class: `${e.prefixCls}-inner`, style: o.value }, [g("div", { class: `${e.prefixCls}-bg`, style: c.value }, null), void 0 !== u.value ? g("div", { class: `${e.prefixCls}-success-bg`, style: m.value }, null) : null])]), null === (t = a.default) || void 0 === t ? void 0 : t.call(a)]) } } }); let Ae = 0; function Ie(e) { return +e.replace("%", "") } function Oe(e) { return Array.isArray(e) ? e : [e] } function De(e, t, a, l) { let s = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0; const r = 50 - l / 2; let o = 0, i = -r, n = 0, c = -2 * r; switch (arguments.length > 5 ? arguments[5] : void 0) { case "left": o = -r, i = 0, n = 2 * r, c = 0; break; case "right": o = r, i = 0, n = -2 * r, c = 0; break; case "bottom": i = r, c = 2 * r }const u = `M 50,50 m ${o},${i}\n   a ${r},${r} 0 1 1 ${n},${-c}\n   a ${r},${r} 0 1 1 ${-n},${c}`, d = 2 * Math.PI * r; return { pathString: u, pathStyle: { stroke: a, strokeDasharray: `${t / 100 * (d - s)}px ${d}px`, strokeDashoffset: `-${s / 2 + e / 100 * (d - s)}px`, transition: "stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s" } } } const Le = u({ compatConfig: { MODE: 3 }, name: "VCCircle", props: y({ gapDegree: Number, gapPosition: { type: String }, percent: { type: [Array, Number] }, prefixCls: String, strokeColor: { type: [Object, String, Array] }, strokeLinecap: { type: String }, strokeWidth: Number, trailColor: String, trailWidth: Number, transition: String }, { percent: 0, prefixCls: "vc-progress", strokeColor: "#2db7f5", strokeLinecap: "round", strokeWidth: 1, trailColor: "#D9D9D9", trailWidth: 1 }), setup(a) { Ae += 1; const l = e(Ae), s = d((() => Oe(a.percent))), r = d((() => Oe(a.strokeColor))), [o, i] = (() => { const a = e(new Map); return t((() => { a.value = new Map })), [e => t => { a.value.set(e, t) }, a] })(); (t => { const a = e(null); m((() => { const e = Date.now(); let l = !1; t.value.forEach((t => { const s = (null == t ? void 0 : t.$el) || t; if (!s) return; l = !0; const r = s.style; r.transitionDuration = ".3s, .3s, .3s, .06s", a.value && e - a.value < 100 && (r.transitionDuration = "0s, 0s") })), l && (a.value = Date.now()) })) })(i); const n = () => { const { prefixCls: e, strokeWidth: t, strokeLinecap: i, gapDegree: n, gapPosition: c } = a; let u = 0; return s.value.map(((a, s) => { const d = r.value[s] || r.value[r.value.length - 1], p = "[object Object]" === Object.prototype.toString.call(d) ? `url(#${e}-gradient-${l.value})` : "", { pathString: f, pathStyle: m } = De(u, a, d, t, n, c); u += a; const y = { key: s, d: f, stroke: p, "stroke-linecap": i, "stroke-width": t, opacity: 0 === a ? 0 : 1, "fill-opacity": "0", class: `${e}-circle-path`, style: m }; return g("path", v({ ref: o(s) }, y), null) })) }; return () => { const { prefixCls: e, strokeWidth: t, trailWidth: s, gapDegree: o, gapPosition: i, trailColor: c, strokeLinecap: u, strokeColor: d } = a, p = function (e, t) { var a = {}; for (var l in e) Object.prototype.hasOwnProperty.call(e, l) && t.indexOf(l) < 0 && (a[l] = e[l]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var s = 0; for (l = Object.getOwnPropertySymbols(e); s < l.length; s++)t.indexOf(l[s]) < 0 && Object.prototype.propertyIsEnumerable.call(e, l[s]) && (a[l[s]] = e[l[s]]) } return a }(a, ["prefixCls", "strokeWidth", "trailWidth", "gapDegree", "gapPosition", "trailColor", "strokeLinecap", "strokeColor"]), { pathString: f, pathStyle: m } = De(0, 100, c, t, o, i); delete p.percent; const y = r.value.find((e => "[object Object]" === Object.prototype.toString.call(e))), h = { d: f, stroke: c, "stroke-linecap": u, "stroke-width": s || t, "fill-opacity": "0", class: `${e}-circle-trail`, style: m }; return g("svg", v({ class: `${e}-circle`, viewBox: "0 0 100 100" }, p), [y && g("defs", null, [g("linearGradient", { id: `${e}-gradient-${l.value}`, x1: "100%", y1: "0%", x2: "0%", y2: "0%" }, [Object.keys(y).sort(((e, t) => Ie(e) - Ie(t))).map(((e, t) => g("stop", { key: t, offset: e, "stop-color": y[e] }, null)))])]), g("path", h, null), n().reverse()]) } } }), Fe = u({ compatConfig: { MODE: 3 }, name: "ProgressCircle", inheritAttrs: !1, props: y(p(p({}, be()), { strokeColor: r() }), { trailColor: null }), setup(e, t) { let { slots: a, attrs: l } = t; const s = d((() => { var t; return null !== (t = e.width) && void 0 !== t ? t : 120 })), r = d((() => { var t; return null !== (t = e.size) && void 0 !== t ? t : [s.value, s.value] })), o = d((() => we(r.value, "circle"))), i = d((() => e.gapDegree || 0 === e.gapDegree ? e.gapDegree : "dashboard" === e.type ? 75 : void 0)), n = d((() => ({ width: `${o.value.width}px`, height: `${o.value.height}px`, fontSize: .15 * o.value.width + 6 + "px" }))), u = d((() => { var t; return null !== (t = e.strokeWidth) && void 0 !== t ? t : Math.max(3 / o.value.width * 100, 6) })), p = d((() => e.gapPosition || "dashboard" === e.type && "bottom" || void 0)), m = d((() => function (e) { let { percent: t, success: a, successPercent: l } = e; const s = Ce(xe({ success: a, successPercent: l })); return [s, Ce(Ce(t) - s)] }(e))), y = d((() => "[object Object]" === Object.prototype.toString.call(e.strokeColor))), h = d((() => function (e) { let { success: t = {}, strokeColor: a } = e; const { strokeColor: l } = t; return [l || c.green, a || null] }({ success: e.success, strokeColor: e.strokeColor }))), k = d((() => ({ [`${e.prefixCls}-inner`]: !0, [`${e.prefixCls}-circle-gradient`]: y.value }))); return () => { var t; const s = g(Le, { percent: m.value, strokeWidth: u.value, trailWidth: u.value, strokeColor: h.value, strokeLinecap: e.strokeLinecap, trailColor: e.trailColor, prefixCls: e.prefixCls, gapDegree: i.value, gapPosition: p.value }, null); return g("div", v(v({}, l), {}, { class: [k.value, l.class], style: [l.style, n.value] }), [o.value.width <= 20 ? g(fe, null, { default: () => [g("span", null, [s])], title: a.default }) : g(f, null, [s, null === (t = a.default) || void 0 === t ? void 0 : t.call(a)])]) } } }), _e = u({ compatConfig: { MODE: 3 }, name: "Steps", props: p(p({}, be()), { steps: Number, strokeColor: i(), trailColor: String }), setup(e, t) { let { slots: a } = t; const l = d((() => Math.round(e.steps * ((e.percent || 0) / 100)))), s = d((() => { var t; return null !== (t = e.size) && void 0 !== t ? t : ["small" === e.size ? 2 : 14, e.strokeWidth || 8] })), r = d((() => we(s.value, "step", { steps: e.steps, strokeWidth: e.strokeWidth || 8 }))), o = d((() => { const { steps: t, strokeColor: a, trailColor: s, prefixCls: o } = e, i = []; for (let e = 0; e < t; e += 1) { const n = Array.isArray(a) ? a[e] : a, c = { [`${o}-steps-item`]: !0, [`${o}-steps-item-active`]: e <= l.value - 1 }; i.push(g("div", { key: e, class: c, style: { backgroundColor: e <= l.value - 1 ? n : s, width: r.value.width / t + "px", height: `${r.value.height}px` } }, null)) } return i })); return () => { var t; return g("div", { class: `${e.prefixCls}-steps-outer` }, [o.value, null === (t = a.default) || void 0 === t ? void 0 : t.call(a)]) } } }), je = new C("antProgressActive", { "0%": { transform: "translateX(-100%) scaleX(0)", opacity: .1 }, "20%": { transform: "translateX(-100%) scaleX(0)", opacity: .5 }, to: { transform: "translateX(0) scaleX(1)", opacity: 0 } }), Ne = e => { const { componentCls: t, iconCls: a } = e; return { [t]: p(p({}, b(e)), { display: "inline-block", "&-rtl": { direction: "rtl" }, "&-line": { position: "relative", width: "100%", fontSize: e.fontSize, marginInlineEnd: e.marginXS, marginBottom: e.marginXS }, [`${t}-outer`]: { display: "inline-block", width: "100%" }, [`&${t}-show-info`]: { [`${t}-outer`]: { marginInlineEnd: `calc(-2em - ${e.marginXS}px)`, paddingInlineEnd: `calc(2em + ${e.paddingXS}px)` } }, [`${t}-inner`]: { position: "relative", display: "inline-block", width: "100%", overflow: "hidden", verticalAlign: "middle", backgroundColor: e.progressRemainingColor, borderRadius: e.progressLineRadius }, [`${t}-inner:not(${t}-circle-gradient)`]: { [`${t}-circle-path`]: { stroke: e.colorInfo } }, [`${t}-success-bg, ${t}-bg`]: { position: "relative", backgroundColor: e.colorInfo, borderRadius: e.progressLineRadius, transition: `all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}` }, [`${t}-success-bg`]: { position: "absolute", insetBlockStart: 0, insetInlineStart: 0, backgroundColor: e.colorSuccess }, [`${t}-text`]: { display: "inline-block", width: "2em", marginInlineStart: e.marginXS, color: e.progressInfoTextColor, lineHeight: 1, whiteSpace: "nowrap", textAlign: "start", verticalAlign: "middle", wordBreak: "normal", [a]: { fontSize: e.fontSize } }, [`&${t}-status-active`]: { [`${t}-bg::before`]: { position: "absolute", inset: 0, backgroundColor: e.colorBgContainer, borderRadius: e.progressLineRadius, opacity: 0, animationName: je, animationDuration: e.progressActiveMotionDuration, animationTimingFunction: e.motionEaseOutQuint, animationIterationCount: "infinite", content: '""' } }, [`&${t}-status-exception`]: { [`${t}-bg`]: { backgroundColor: e.colorError }, [`${t}-text`]: { color: e.colorError } }, [`&${t}-status-exception ${t}-inner:not(${t}-circle-gradient)`]: { [`${t}-circle-path`]: { stroke: e.colorError } }, [`&${t}-status-success`]: { [`${t}-bg`]: { backgroundColor: e.colorSuccess }, [`${t}-text`]: { color: e.colorSuccess } }, [`&${t}-status-success ${t}-inner:not(${t}-circle-gradient)`]: { [`${t}-circle-path`]: { stroke: e.colorSuccess } } }) } }, Ee = e => { const { componentCls: t, iconCls: a } = e; return { [t]: { [`${t}-circle-trail`]: { stroke: e.progressRemainingColor }, [`&${t}-circle ${t}-inner`]: { position: "relative", lineHeight: 1, backgroundColor: "transparent" }, [`&${t}-circle ${t}-text`]: { position: "absolute", insetBlockStart: "50%", insetInlineStart: 0, width: "100%", margin: 0, padding: 0, color: e.colorText, lineHeight: 1, whiteSpace: "normal", textAlign: "center", transform: "translateY(-50%)", [a]: { fontSize: e.fontSize / e.fontSizeSM + "em" } }, [`${t}-circle&-status-exception`]: { [`${t}-text`]: { color: e.colorError } }, [`${t}-circle&-status-success`]: { [`${t}-text`]: { color: e.colorSuccess } } }, [`${t}-inline-circle`]: { lineHeight: 1, [`${t}-inner`]: { verticalAlign: "bottom" } } } }, Te = e => { const { componentCls: t } = e; return { [t]: { [`${t}-steps`]: { display: "inline-block", "&-outer": { display: "flex", flexDirection: "row", alignItems: "center" }, "&-item": { flexShrink: 0, minWidth: e.progressStepMinWidth, marginInlineEnd: e.progressStepMarginInlineEnd, backgroundColor: e.progressRemainingColor, transition: `all ${e.motionDurationSlow}`, "&-active": { backgroundColor: e.colorInfo } } } } } }, We = e => { const { componentCls: t, iconCls: a } = e; return { [t]: { [`${t}-small&-line, ${t}-small&-line ${t}-text ${a}`]: { fontSize: e.fontSizeSM } } } }, ze = h("Progress", (e => { const t = e.marginXXS / 2, a = k(e, { progressLineRadius: 100, progressInfoTextColor: e.colorText, progressDefaultColor: e.colorInfo, progressRemainingColor: e.colorFillSecondary, progressStepMarginInlineEnd: t, progressStepMinWidth: t, progressActiveMotionDuration: "2.4s" }); return [Ne(a), Ee(a), Te(a), We(a)] })); const Pe = A(u({ compatConfig: { MODE: 3 }, name: "AProgress", inheritAttrs: !1, props: y(be(), { type: "line", percent: 0, showInfo: !0, trailColor: null, size: "default", strokeLinecap: "round" }), slots: Object, setup(e, t) { let { slots: a, attrs: l } = t; const { prefixCls: s, direction: r } = x("progress", e), [o, i] = ze(s), n = d((() => Array.isArray(e.strokeColor) ? e.strokeColor[0] : e.strokeColor)), c = d((() => { const { percent: t = 0 } = e, a = xe(e); return parseInt(void 0 !== a ? a.toString() : t.toString(), 10) })), u = d((() => { const { status: t } = e; return !ke.includes(t) && c.value >= 100 ? "success" : t || "normal" })), p = d((() => { const { type: t, showInfo: a, size: l } = e, o = s.value; return { [o]: !0, [`${o}-inline-circle`]: "circle" === t && we(l, "circle").width <= 20, [`${o}-${"dashboard" === t ? "circle" : t}`]: !0, [`${o}-status-${u.value}`]: !0, [`${o}-show-info`]: a, [`${o}-${l}`]: l, [`${o}-rtl`]: "rtl" === r.value, [i.value]: !0 } })), f = d((() => "string" == typeof e.strokeColor || Array.isArray(e.strokeColor) ? e.strokeColor : void 0)); return () => { const { type: t, steps: i, title: c } = e, { class: d } = l, m = function (e, t) { var a = {}; for (var l in e) Object.prototype.hasOwnProperty.call(e, l) && t.indexOf(l) < 0 && (a[l] = e[l]); if (null != e && "function" == typeof Object.getOwnPropertySymbols) { var s = 0; for (l = Object.getOwnPropertySymbols(e); s < l.length; s++)t.indexOf(l[s]) < 0 && Object.prototype.propertyIsEnumerable.call(e, l[s]) && (a[l[s]] = e[l[s]]) } return a }(l, ["class"]), y = (() => { const { showInfo: t, format: l, type: r, percent: o, title: i } = e, n = xe(e); if (!t) return null; let c; const d = l || (null == a ? void 0 : a.format) || (e => `${e}%`), p = "line" === r; return l || (null == a ? void 0 : a.format) || "exception" !== u.value && "success" !== u.value ? c = d(Ce(o), Ce(n)) : "exception" === u.value ? c = g(p ? w : $, null, null) : "success" === u.value && (c = g(p ? S : ve, null, null)), g("span", { class: `${s.value}-text`, title: void 0 === i && "string" == typeof c ? c : void 0 }, [c]) })(); let h; return "line" === t ? h = i ? g(_e, v(v({}, e), {}, { strokeColor: f.value, prefixCls: s.value, steps: i }), { default: () => [y] }) : g(Se, v(v({}, e), {}, { strokeColor: n.value, prefixCls: s.value, direction: r.value }), { default: () => [y] }) : "circle" !== t && "dashboard" !== t || (h = g(Fe, v(v({}, e), {}, { prefixCls: s.value, strokeColor: n.value, progressStatus: u.value }), { default: () => [y] })), o(g("div", v(v({ role: "progressbar" }, m), {}, { class: [p.value, d], title: c }), [h])) } } })), Me = { key: 0, class: "container" }, Re = { class: "title" }, Ue = { class: "multi-color-progress" }, Be = { class: "progress-outer" }, Xe = { class: "progress" }, qe = { class: "percent" }, Ve = { class: "percent-text" }, Ke = T(u({ __name: "UploadProgress", setup(t) { const { dataSource: a, totalStatus: l, kbTotal: s } = I(ue()), r = ge().progress, o = e({ green: 0, yellow: 0, red: 0, gray: 0 }), i = e({ green: 0, yellow: 0, red: 0, gray: 0 }), n = e({ green: 0, yellow: 0, red: 0, gray: 0 }); return O((() => l), (() => { (() => { o.value = l.value; for (const t in o.value) { const e = o.value[t] / s.value * 100; i.value[t] = parseFloat(e.toFixed(2)) } const e = 100 - Object.values(i.value).reduce(((e, t) => e + t), 0); e > 0 && (i.value.gray += e), n.value.green = i.value.green, n.value.red = i.value.red + n.value.green, n.value.yellow = i.value.yellow + n.value.red, n.value.gray = i.value.gray + n.value.yellow })() }), { immediate: !0, deep: !0 }), (e, t) => { const l = Pe, s = fe; return 0 !== D(a).length ? (L(), F("div", Me, [_("span", Re, j(D(r).uploadTotalProgress) + "：", 1), g(s, { title: `${D(r).putStorage}: ${D(o).green},\n      ${D(r).inLine}: ${D(o).gray},\n      ${D(r).parsing}: ${D(o).yellow},\n      ${D(r).failure}: ${D(o).red}` }, { default: N((() => [_("div", Ue, [_("div", Be, [_("div", Xe, [g(l, { percent: D(n).green, class: "progress-segment green", status: "active", "stroke-color": "#52c41a" }, null, 8, ["percent"]), g(l, { percent: D(n).red, class: "progress-segment red", status: "active", "stroke-color": "#f5222d" }, null, 8, ["percent"]), g(l, { percent: D(n).yellow, class: "progress-segment yellow", status: "active", "stroke-color": "#FFEB3B" }, null, 8, ["percent"]), g(l, { percent: D(n).gray, class: "progress-segment gray", status: "active", "stroke-color": "#bfbfbf" }, null, 8, ["percent"])])]), _("div", qe, [_("div", Ve, j((D(i).green + D(i).red).toFixed(2)) + "% ", 1)])])])), _: 1 }, 8, ["title"])])) : E("", !0) } } }), [["__scopeId", "data-v-742741e5"]]), Qe = { class: "file" }, Ze = { class: "box" }, He = { class: "before-upload-box" }, Je = ["accept"], Ye = { class: "before-upload" }, Ge = { class: "upload-text-box" }, et = { class: "upload-text" }, tt = { class: "blue" }, at = { class: "desc" }, lt = T(u({ __name: "FileUploadDialog", props: { dialogType: { type: Number, require: !0, default: 0 } }, setup(t) { const a = ge().common, { setKnowledgeName: l, setModalVisible: s } = de(), { setDefault: r } = re(), { getDetails: o } = ue(), { modalVisible: i, modalTitle: n } = I(de()), { currentId: c, currentKbName: u } = I(re()), { uploadFileList: p, uploadFileListQuick: v } = I(pe()), { initUploadFileList: f } = pe(), { chatSettingFormActive: m } = I(me()), y = t, h = e(), k = d((() => c.value.length > 0 && p.value.length > 0 && p.value.every((e => "loading" != e.status)))); O((() => i.value), (() => { l(u.value), 1 === y.dialogType && (p.value = v.value), i.value || 0 !== y.dialogType || f() })); const b = [".md", ".txt", ".pdf", ".jpg", ".png", ".jpeg", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".jsonl", ".eml", ".csv"], C = { document: 31457280, image: 5242880 }, x = e => { const t = e.target.files; let l = 0; Array.from(t).forEach((e => { l += e.size, l >= 131072e3 && B.error("文件总大小超过125MB") })), Array.from(t).forEach((async (e, t) => { try { await (async (e, t) => new Promise(((l, s) => { if (e.name && b.includes("." + e.name.split(".").pop().toLowerCase())) { const r = e.type.startsWith("image/") ? C.image : C.document, o = e.type.startsWith("image/") ? "图片" : "文档"; if (e.size > r) return void s(`单个${o}太大，不能超过 ${r / 1024 / 1024} MB`); p.value.push({ file_name: e.name, file: e, status: "loading", text: a.uploading, file_id: "", order: p.value.length, bytes: 0 }), l(t) } else s(`${e.name}的文件格式不符`) })))(e, t) } catch (l) { B.error(l) } })), setTimeout((() => { p.value.length && w() })) }, w = async () => { var e; A(); const t = []; p.value.forEach((e => { "loading" == e.status && t.push(e) })); const l = new FormData; for (let a = 0; a < t.length; a++)l.append("files", null == (e = t[a]) ? void 0 : e.file); l.append("kb_id", c.value), l.append("user_id", G), l.append("user_info", ee), l.append("chunk_size", m.value.chunkSize.toString()), l.append("mode", "soft"), $(0), fetch(te + "/rag/upload_files", { method: "POST", body: l }).then((e => { if (e.ok) return e.json(); throw new Error("上传失败") })).then((e => { if (200 === e.code) { if (0 === e.data.length) return B.warn(e.msg || "出错了"), X.close("upload"), void (1 === y.dialogType && t.forEach((t => { p.value[t.order].status = "error", p.value[t.order].errorText = (null == e ? void 0 : e.msg) || a.upFailed }))); $(1), 1 === y.dialogType && t.forEach(((t, l) => { let s = e.data[l].status; s = "green" == s || "gray" == s ? "success" : "error", p.value[t.order].status = s, p.value[t.order].file_id = e.data[l].file_id, p.value[t.order].bytes = e.data[l].bytes, p.value[t.order].errorText = a.upSucceeded })) } else B.error(e.msg || "出错了"), X.close("upload"), t.forEach((t => { p.value[t.order].status = "error", p.value[t.order].errorText = (null == e ? void 0 : e.msg) || a.upFailed })) })).catch((e => { B.error(e.msg || "出错了"), X.close("upload") })).finally((() => { o() })) }, $ = e => { X[e ? "success" : "info"]({ key: "upload", message: e ? "上传完成" : "上传中", description: e ? "" : "最多需要30s", duration: e ? 2.5 : 0 }) }, S = async () => { s(!1), r(oe.optionlist), await o() }, A = () => { s(!1) }; return W((() => { h.value && clearTimeout(h.value) })), (e, t) => { const l = q, s = V; return L(), z(U, { to: "body" }, [g(s, { open: D(i), "onUpdate:open": t[1] || (t[1] = e => R(i) ? i.value = e : null), title: D(n), centered: "", width: "480px", "wrap-class-name": "upload-file-modal", "destroy-on-close": "" }, { footer: N((() => [0 === y.dialogType ? (L(), z(l, { key: "submit", type: "primary", class: "upload-btn", disabled: !D(k), onClick: S }, { default: N((() => [P(j(D(a).confirm), 1)])), _: 1 }, 8, ["disabled"])) : E("", !0), 1 === y.dialogType ? (L(), z(l, { key: "submit", type: "primary", class: "upload-btn", onClick: A }, { default: N((() => [P(j(D(a).cancel), 1)])), _: 1 })) : E("", !0)])), default: N((() => [_("div", Qe, [_("div", Ze, [_("div", He, [_("input", { class: "hide input", type: "file", accept: b.join(","), multiple: "", onChange: x, onClick: t[0] || (t[0] = e => e.target.value = "") }, null, 40, Je), _("div", Ye, [_("div", Ge, [g(M, { name: "upload" }), _("p", null, [_("span", et, [P(j(D(a).dragUrl) + " ", 1), _("span", tt, j(D(a).click), 1)])])]), _("p", at, j(D(a).updesc1), 1)])])])])])), _: 1 }, 8, ["open", "title"])]) } } }), [["__scopeId", "data-v-ee0fadb0"]]), st = { class: "list-page" }, rt = { class: "content" }, ot = { class: "options" }, it = (e => (J("data-v-acc533cc"), e = e(), Y(), e))((() => _("img", { src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAKFSURBVFiF1ZjNattAEIC/VH0Ag3O3wb0b+gKF0HMCfoAW/AAFP0ALaZ8guffQvoFzzsF5hNwLUu4F+Q2mB+1Yk9XfriTXycAiWdbufDuz2p2ZMxFJeMHy5tQAXfJ2YP8J8AGYufuZe/4E7N31wd3/N8AJ8Am4Apbud5dsgTvgV6yys8g1+AX4ZqD2wKNrajEoLbqksLBKBvyIAhWRJKC9F5FUStmJyEpEpgF9p+7dnemfisgiRHcI4FpEcgN2ETipprF0orkDHwR4bWZ9MwDMbzdm3Ou+gCszyGZEuLrJr2MBF1K6tXWGA9vG6cilWOfBgKnrOKZbu9ydhgKu2zoEtoWzTshXnkj5hVeWUh2gWq9xXQTA6Riha/fCvZ/7k/IB1Xq7EeDSCAs2WtEPFi7d9Tb8cDnIHLh31wz4SNwZrDqv7EN71E2Av+7+PHLwOrgsor/q/+Pu36l+a0E9M2OjjzHgoDzXNULCB9RQ6fEEcCqq+xAhWUAboZwCzupWY9Va8Ikw+cm4cFZ3LWCszLpfGS4WsELfIWq1OaWrh0rFixZQ/R8SwsNz184ZB7LyHdRZcBkxYMa4kKr7YEF/o65slIFi4TL6b9SVg8J3cWWjDBQLZWFjRHVuaXCx/glF9hYrGcMgVefds6deRDGVMpLumxz1CbcaY9C6eFDD8L4hl040JmDVCVVi0FcZ8idSJDDq6mNkdNo0s8ulIZFvSzt1XYgcJ7PbmPEbE/hXnbhrW0np7lT6J1OJFDuD5h55yFihxaOFjF88qk3U/RZbfvsMfPU24Afay2+2hrgHvhORlMUCWtBLvAysQfQI3QK/iay29gVUaSsBaxl4UAl4KODR5cVX+f8BBZDb8KKHVtYAAAAASUVORK5CYII=", alt: "back" }, null, -1))), nt = { class: "kb-name" }, ct = { class: "name" }, ut = { class: "id" }, dt = { class: "nav-info" }, pt = { class: "navs" }, gt = { class: Q(["nav-item", "nav-item-active"]) }, vt = { key: 0, class: "nav-progress" }, ft = { class: "handle-btn" }, mt = { style: { color: "#666" } }, yt = { key: 1 }, ht = { style: { color: "#666", "user-select": "text" } }, kt = { style: { color: "#666", "user-select": "text" } }, bt = { key: 3, class: "status-box" }, Ct = { class: "icon-file-status" }, xt = { key: 0, style: { color: "#666", "user-select": "text" } }, wt = { key: 1, style: { color: "#666", "user-select": "text" } }, $t = { key: 0 }, St = { key: 1 }, At = { key: 0, class: "status-box" }, It = { class: "icon-file-status" }, Ot = { key: 1, class: "options" }, Dt = T(u({ __name: "OptionList", setup(t) { const { setDefault: a } = re(), { currentKbName: l, currentId: s } = I(re()), { setModalVisible: r, setUrlModalVisible: o, setModalTitle: i } = de(), { setShowChunkModel: n, setFileId: c, setFileIdName: u } = ie(), { getDetails: p, setEditQaSet: v, setEditModalVisible: m, getFaqList: y, setFaqType: h, setPageNum: k, setKbPageNum: b, setKbTotal: C, getAllDetails: x, getSearchData: w } = ue(), { allDataSource: $, dataSource: S, faqList: A, timer: T, faqTimer: R, total: U, pageNum: X, pageSize: Q, loading: J, kbTotal: Y, kbPageNum: G, kbPageSize: ee, searchTotal: te, inputValue: pe, searchDataSource: ve, isSearch: me, totalStatus: ke } = I(ue()), { getB64Type: be } = ne(), Ce = ge().home, xe = ge().common, we = ge().bots, $e = d((() => Ae.value)), Se = e(null), Ae = d((() => s.value.endsWith("_FAQ") ? 1 : 0)), Ie = e([]), Oe = d((() => Ie.value && Ie.value.length > 0)), De = e(0), Le = () => { Ie.value = [] }, Fe = d((() => [{ title: Ce.documentId, dataIndex: "fileId", key: "fileId", width: "8%", ellipsis: !0 }, { title: Ce.documentName, dataIndex: "fileIdName", key: "fileIdName", width: "15%", ellipsis: !0, filters: me.value ? null : [{ text: "docx,doc", value: "docx,doc" }, { text: "xlsx,xls", value: "xlsx,xls" }, { text: "pdf", value: "pdf" }, { text: "pptx,ppt", value: "pptx,ppt" }, { text: "txt,csv,eml,jsonl", value: "txt,csv,eml,jsonl" }, { text: "jpg,jpeg,png", value: "jpg,jpeg,png" }, { text: "md", value: "md" }, { text: "web", value: "web" }], filteredValue: Ie.value }, { title: Ce.documentStatus, dataIndex: "status", key: "status", width: "10%", ellipsis: !0 }, { title: Ce.fileSize, dataIndex: "bytes", key: "bytes", width: "8%" }, { title: Ce.contentLength, dataIndex: "contentLength", key: "contentLength", width: "10%" }, { title: Ce.creationDate, dataIndex: "createtime", key: "createtime", width: "10%" }, { title: Ce.remark, dataIndex: "remark", key: "remark", width: "13%", ellipsis: !0 }, { title: Ce.operate, key: "options", width: "13%" }])), _e = [{ title: "ID", dataIndex: "id", key: "id", width: "8%" }, { title: Ce.question, dataIndex: "question", key: "question", width: "43%", ellipsis: !0 }, { title: Ce.status, dataIndex: "status", key: "status", width: "10%", ellipsis: !0 }, { title: Ce.characterCount, dataIndex: "bytes", key: "bytes", width: "10%" }, { title: Ce.creationDate, dataIndex: "createtime", key: "createtime", width: "11%" }, { title: Ce.operate, key: "options", width: "10%" }], je = d((() => ({ current: G.value, pageSize: ee.value, total: Oe.value ? De.value : me.value ? te.value : Y.value, showSizeChanger: !1, showTotal: e => `共 ${e} 条` }))), Ne = d((() => ({ current: X.value, pageSize: Q.value, total: U.value, showSizeChanger: !1, showTotal: e => `共 ${e} 条` }))); let Ee = {}; const Te = async () => { try { await ae(await le.deleteFile({ file_ids: [Ee.fileId], kb_id: s.value })), B.success("删除成功"), await p(), 1 !== G.value && 0 === S.value.length && (G.value -= 1, await p()) } catch (e) { B.error(e.msg || "删除失败") } }; let We = {}; const ze = async () => { try { await ae(await le.deleteFile({ kb_id: s.value.includes("_") ? s.value : s.value + "_FAQ", file_ids: [We.faqId] })), B.success("删除成功"), await y(), 1 !== X.value && 0 === A.value.length && (X.value -= 1, await y()) } catch (e) { B.error(e.msg || "删除失败") } }, Pe = () => { a(oe.normal) }, Me = () => { r(!0), i(Ce.upload) }, Re = () => { o(!0), i(xe.addUrl) }, Ue = () => { h("upload"), m(!0) }, Be = () => { V.confirm({ title: Ce.clearAllFile, content: Z("p", Ce.clearAllFileConfirm), centered: !0, maskClosable: !0, okText: xe.confirm, okType: "danger", async onOk() { try { await ae(await le.clearUpload({ status: "gray", kb_ids: [] })), B.success("操作成功"), p() } catch (e) { B.error(e.msg || "操作失败") } } }) }, Xe = e => { let t; switch (e) { case "gray": t = xe.inLine; break; case "yellow": t = xe.parsing; break; case "green": t = xe.succeeded; break; default: t = xe.failed }return t }, qe = e => { let t = xe.failed; switch (e) { case "gray": t = xe.uploadCompleted; break; case "yellow": t = xe.inLine; break; case "green": t = xe.learningCompleted }return t }, Ve = e => { const { current: t } = e; k(t), y() }, Qe = async (e, t, a, { action: l }) => { if (me.value) return b(e.current), await w(pe.value), void (S.value = ve.value); Ie.value = JSON.parse(JSON.stringify(t.fileIdName)), "filter" === l && Ie.value && Ie.value.length > 0 ? Ze(Ie.value) : (b(e.current), p()) }, Ze = async e => { await x(); const t = $.value.filter((t => { var a; const l = null == (a = t.fileIdName.split(".").pop()) ? void 0 : a.toLowerCase(); return e.some((e => e.split(",").map((e => e.trim().toLowerCase())).includes(l))) })); S.value = t, C($.value.length), De.value = t.length, b(1) }, He = e(new Map), Je = e => { const t = e.fileId, a = e.fileIdName; He.value.has(t) ? He.value.delete(t) : He.value.set(t, a) }, Ye = (...e) => { e[2].map((e => { const t = e.key, a = e.fileIdName; He.value.has(t) ? He.value.delete(t) : He.value.set(t, a) })) }; return O(s, (async e => { b(1), k(1), Le(), e.endsWith("_FAQ") ? y() : me.value ? (await w(pe.value), S.value = ve.value) : p() }), { immediate: !0 }), O((() => pe.value), (async () => { me.value ? (await w(pe.value), S.value = ve.value) : p() })), W((() => { clearTimeout(T.value), clearTimeout(R.value), Le(), b(1), k(1) })), (e, t) => { const a = q, r = M, o = fe, i = ye, d = he, p = H; return L(), z(p, { theme: { token: { colorPrimary: "#5a47e5" } } }, { default: N((() => [_("div", st, [_("div", rt, [_("div", ot, [_("div", { class: "to-chat", onClick: Pe }, [it, _("span", null, j(D(Ce).conversation), 1)]), _("div", nt, [_("div", ct, j(D(l)), 1), _("div", ut, j(D(Ce).knowledgeID) + " " + j(D(s)), 1)])]), _("div", dt, [_("div", pt, [_("div", gt, j(0 === D($e) ? D(Ce).docSet : D(Ce).qaSet), 1)]), 0 === D($e) ? (L(), F("div", vt, [g(Ke, { "total-status": D(ke), "total-count": D(Y) }, null, 8, ["total-status", "total-count"])])) : E("", !0), _("div", ft, [0 === D($e) ? (L(), z(a, { key: 0, danger: "", class: "clear-upload", onClick: Be }, { default: N((() => [P(j(D(Ce).clearAllFile), 1)])), _: 1 })) : E("", !0), 0 === D($e) ? (L(), z(a, { key: 1, class: "upload", onClick: Me }, { default: N((() => [P(j(D(Ce).upload), 1)])), _: 1 })) : E("", !0), 0 === D($e) ? (L(), z(a, { key: 2, class: "add-link", onClick: Re }, { default: N((() => [P(j(D(Ce).addUrl), 1)])), _: 1 })) : E("", !0), 1 === D($e) ? (L(), z(a, { key: 3, class: "upload", onClick: Ue }, { default: N((() => [P(j(D(Ce).inputQa), 1)])), _: 1 })) : E("", !0)])]), _("div", { ref_key: "kbTableRef", ref: Se, class: "table" }, [0 === D($e) ? (L(), z(d, { key: 0, "data-source": D(S), columns: D(Fe), pagination: D(je), locale: { emptyText: D(Ce).emptyText }, "hide-on-single-page": !0, "show-size-changer": !1, "row-selection": { selectedRowKeys: [...D(He).keys()], onSelect: Je, onSelectAll: Ye }, onChange: Qe }, { headerCell: N((({ column: e }) => ["status" === e.key ? (L(), F(f, { key: 0 }, [_("span", null, j(D(Ce).documentStatus), 1), g(o, { color: "#fff" }, { title: N((() => [_("span", mt, j(D(Ce).documentStatusNode), 1)])), default: N((() => [g(r, { style: { width: "13px", height: "13px", "margin-left": "5px" }, name: "question" })])), _: 1 })], 64)) : "contentLength" === e.key ? (L(), F("span", yt, j(D(Ce).contentLength), 1)) : E("", !0)])), bodyCell: N((({ column: e, record: t }) => ["fileId" === e.key ? (L(), z(o, { key: 0, color: "#fff", placement: "topLeft", "get-popup-container": () => D(Se) }, { title: N((() => [_("span", ht, j(t.fileId), 1)])), default: N((() => [_("span", null, j(t.fileId), 1)])), _: 2 }, 1032, ["get-popup-container"])) : "fileIdName" === e.key ? (L(), z(o, { key: 1, color: "#fff", placement: "topLeft" }, { title: N((() => [_("span", kt, j(t.fileIdName), 1)])), default: N((() => [_("span", null, j(t.fileIdName), 1)])), _: 2 }, 1024)) : "contentLength" === e.key ? (L(), F(f, { key: 2 }, [P(j(-1 === t.contentLength ? "-" : t.contentLength), 1)], 64)) : "status" === e.key ? (L(), F("div", bt, [_("span", Ct, ["gray" === t.status || "yellow" === t.status ? (L(), z(ce, { key: 0, class: "file-status" })) : (L(), z(r, { key: 1, class: "file-status", name: "green" === t.status ? "success" : "error" }, null, 8, ["name"]))]), _("span", null, j(Xe(t.status)), 1)])) : "remark" === e.key ? (L(), z(o, { key: 4, color: "#fff", placement: "topLeft", "get-popup-container": () => D(Se) }, { title: N((() => ["string" == typeof t.remark ? (L(), F("div", xt, j(t.remark), 1)) : (L(), F("div", wt, [(L(!0), F(f, null, K(t.remark, ((e, t) => (L(), F("div", { key: t }, j(`${t}: ${e}`), 1)))), 128))]))])), default: N((() => ["string" == typeof t.remark ? (L(), F("span", $t, j(t.remark), 1)) : (L(), F("span", St, [(L(!0), F(f, null, K(t.remark, ((e, t) => (L(), F("span", { key: t }, j(`${t}: ${e}`) + "; ", 1)))), 128))]))])), _: 2 }, 1032, ["get-popup-container"])) : "options" === e.key ? (L(), F(f, { key: 5 }, [g(i, { "overlay-class-name": "del-pop", placement: "topRight", title: D(xe).deleteTitle, "ok-text": D(xe).confirm, "cancel-text": D(xe).cancel, onConfirm: Te }, { default: N((() => [g(a, { type: "text", class: "delete-item", onClick: e => { Ee = t } }, { default: N((() => [P(j(D(xe).delete), 1)])), _: 2 }, 1032, ["onClick"])])), _: 2 }, 1032, ["title", "ok-text", "cancel-text"]), g(a, { type: "text", class: "view-item", disabled: !("green" === t.status), onClick: e => { return c((a = t).fileId), u(a.fileIdName), void n(!0); var a } }, { default: N((() => [P(j(D(xe).view), 1)])), _: 2 }, 1032, ["disabled", "onClick"]), g(a, { type: "text", class: "download-item", onClick: e => (async e => { try { const t = await ae(await le.getFile({ file_id: e.fileId })), a = "web" === e.fileIdName.split(".").pop() ? "md" : e.fileIdName.split(".").pop(), l = "md" === a ? `${e.fileIdName.split(".")[0]}.${a}` : e.fileIdName, s = t.file_base64; if (s) { const e = be(a), t = atob(s), r = new Uint8Array(t.length); for (let a = 0; a < t.length; a++)r[a] = t.charCodeAt(a); const o = new Blob([r], { type: e }), i = URL.createObjectURL(o); se(i, l), URL.revokeObjectURL(i) } else B.error("not found base64") } catch (t) { B.error(t.msg) } })(t) }, { default: N((() => [P(j(D(xe).download), 1)])), _: 2 }, 1032, ["onClick"])], 64)) : E("", !0)])), _: 1 }, 8, ["data-source", "columns", "pagination", "locale", "row-selection"])) : (L(), z(d, { key: 1, "data-source": D(A), columns: _e, locale: { emptyText: D(Ce).emptyText }, loading: D(J), pagination: D(Ne), onChange: Ve }, { bodyCell: N((({ column: e, record: t }) => ["status" === e.key ? (L(), F("div", At, [_("span", It, ["gray" === t.status || "yellow" === t.status ? (L(), z(ce, { key: 0, class: "file-status" })) : (L(), z(r, { key: 1, class: "file-status", name: "green" === t.status ? "success" : "error" }, null, 8, ["name"]))]), _("span", null, j(qe(t.status)), 1)])) : "options" === e.key ? (L(), F("div", Ot, [g(a, { class: "edit-item", type: "link", disabled: "green" !== t.status, onClick: e => { return a = t, h("edit"), v(a), void m(!0); var a } }, { default: N((() => [P(j(D(we).edit), 1)])), _: 2 }, 1032, ["disabled", "onClick"]), g(i, { "overlay-class-name": "qa-del-pop", placement: "topRight", title: D(Ce).deleteQaSetText, "ok-text": D(xe).confirm, "cancel-text": D(xe).cancel, onConfirm: ze }, { default: N((() => [g(a, { class: "delete-item", danger: "", type: "link", onClick: e => { We = t } }, { default: N((() => [P(j(D(xe).delete), 1)])), _: 2 }, 1032, ["onClick"])])), _: 2 }, 1032, ["title", "ok-text", "cancel-text"])])) : E("", !0)])), _: 1 }, 8, ["data-source", "locale", "loading", "pagination"]))], 512)])]), g(lt, { "dialog-type": 0 })])), _: 1 }) } } }), [["__scopeId", "data-v-acc533cc"]]); export { lt as F, Dt as O, Pe as _ };
