import{am as e,r as a,d as t,o,$ as s,k as l,y as n,D as i,j as r,A as d,w as c}from"./index-BVM7diGR.js";import{a as u}from"./index-BTL0xIAV.js";import{L as p,r as m,u as f}from"./urlConfig-5Ad6E0st.js";import{g}from"./index-DAdVxPIc.js";const w=e("useChunkView",(()=>{const e=a(!1),t=a(""),o=a(""),s=a(new p(5));return{showChunkModel:e,setShowChunkModel:a=>{e.value=a},fileId:t,setFileId:e=>{t.value=e},fileIdName:o,setFileIdName:e=>{o.value=e},chunkCacheData:s}})),A="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAATYSURBVFiFxZdtiFRVGMd/z3nu7KyO7vrCqMmuiIaKVFRWWmBqWRZSRmGfegGDCKkotBffmdQICvogfTECUYqISrLUMI1VUowQDEEiLCQXV3ZzdVd3ZmfmnvP0YWbWXdZdd3XDP9wv9577/H/3uef8z71iZspNlLuZ5gDRYAYvyHB7IeZe75mJUG+B0YapIJeBJuc4maji8KENHBtoTbnWK2gAWbeOhUUfnjJzExEUUDHUBEVQAlHlvBkqYk1RJDteXMI3L88iXDfAE5uZ0NzB68AUyoZiJVMzIhEUs8gQRSzqgjJRMBXhzxHDZeWBtZweNMCCDHdl87xikBJDxeGs/KRiaBAiKb3CCMoQWCQmXaBW6ko2obxzeCMHBgwwdz13Fj3LCVSZ4CrFBDzCb5Hwa20tp5Y8xHmAr38g3REzIxgPe88jIqTMUAE1cCIEVV47spGfrgnwaIbx7fmwGtxwo2xOUCccTY91X+xawYW+2gmw+EPS5y+wwowlZWhnoEDHqOE8uW8tf/cJ0NCArNrHuwaTDFz5ZqfKl1ej709zVvOCwfqyuaNU7+RLz/B494nZIwc2HOSBABNN8CJ4E3wiweeDNQc4+j7bVdmEoaXD1OCObd/yfPdxPQDyeeYDXgxvhlfj6C8Zfh6seUVHNrJNhO/AFMQBGhuvXhVgYYapwGgxPOCBXF2anddrXtG4FJtBiohFGApMnbuOub0AOmNmUG67GT5yHP/qTdpuFOD7NZwTxx7KyxNDC4HHegGYUSeGFwleHLEm+P1GzStSx+5KflBKyzm9AAKMMsGDizH8hBoahwqgNuI4VgktFJjWC8AgCcQYHke88EEuDRXAspmctbK5gWKkK9eu7IYBL4ILgjmDabOwoQJYuhR/YQrVANMu9azb1QFxXMaInQUPxJ9+wMihAmhoQP44RNR0Aj14muhEjq7w696B8yYkMWcCdjbPeKB9KABaWnCNSbQx20J1Nm1tqcYAdUC3DiQSNIrgXTkFCwWmDoU5QEMLVcUCEZfSGpJo9+ndBZBy/GXlBDQL3sPk57aQulHzrcdwZ3JUSw6lCr3YgdbW1fleAHs3cEYdrSZ4nIudIKf/ZfaNAuw/1D7SByIS6OVOtBbYsJTeAAAaccwJ3gLBAj4UmTJvPTOv1/zZrYxoy9akOgtotoBKoUM1otB9TA+A9+Zx0hzNInhxpViOjXsWZpg+aPOPqW1tYmwhRl2xdCRJhe0r6ewTYP58rH40+zE6zQjO4YMn5ArcPS/D7Ld2lNZyf9qyl2jR5tzElnbGFWNUwcWCYxgsuK/33nLVT7JFm5jUnvPzEDUHway0OgIUkgnO1AzjbO0ttC2rJw+wq4XEqX9IZS9Tk/eMdBBM8ZHifT4fElHST0/T/MlycgMCAFi8mbqLee4Pwasz9VZeomZ4jNhc7JUoBmJTYoQ48vjgi56qRKwQQoxPko/rRybPffY22av59PlntHsNjePG8KOatop4E8GCYSIYeHDRlUgNSOSRoIhpQhRc8EiUpHDbmJbGvsz77UBFDQ1I5iCT83F8K0i1GV5FfQixj6IotlCarBrwweFN8VWeXPUwmvesorW/2gMC6K6nP2LsxRzpUKQmFqodOAv4IORV6UhBe3UtF3e+MfCddFAA/4du+t/xf3hVSVyjFiskAAAAAElFTkSuQmCC",C=i(t({__name:"LoadingImg",setup(e){const t=a();return o((()=>{t.value&&t.value.classList.add("loading")})),s((()=>{t.value&&t.value.classList.remove("loading")})),(e,a)=>(l(),n("img",{ref_key:"loadingRef",ref:t,class:"img",src:A,alt:"loading"},null,512))}}),[["__scopeId","data-v-e69df7ef"]]),{setSourceType:h,setSourceUrl:x,setTextContent:v}=u(),{preCacheData:B}=r(u()),{setShowChunkModel:b,setFileId:I,setFileIdName:U}=w();function S(){const e=a(""),t=a(""),o=a(""),s=["text/markdown","text/plain","application/pdf","image/jpeg","image/png","image/jpeg","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/jsonl","text/csv","message/rfc822"],l=["md","txt","pdf","jpg","png","jpeg","doc","docx","xls","xlsx","ppt","pptx","jsonl","csv","eml","faq","web"],n=e=>{const a=l.indexOf(e);return s[a]},i=e=>{if(!e)return!1;const a=e.split(".");if(a.length){const e=a.pop().toLowerCase();return!!l.includes(e)}return!1};return{textContent:e,sourceUrl:o,sourceType:t,getB64Type:n,supportSourceTypes:l,checkFileType:i,handleChatSource:e=>{i(e.file_name)&&async function(e){try{x(null);const a=await m(await f.getFile({file_id:e.file_id})),t="web"===e.file_name.split(".").pop()?"md":e.file_name.split(".").pop().toLowerCase(),o=n(t);h(t),x(`data:${o};base64,${a.file_base64}`);const s={sourceUrl:`data:${o};base64,${a.file_base64}`,sourceType:t};if("txt"===t||"md"===t||"csv"===t||"eml"===t||"jsonl"===t){const e=atob(a.file_base64),t=decodeURIComponent(escape(e));v(t),s.textContent=t}B.value.set(`preCache_${e.file_id}`,s)}catch(a){d.error(a.msg||"获取文件失败")}}(e)},handleChatSourceBlank:e=>{if(i(e.file_name)){const a=e.file_name.split(".").pop().toLowerCase(),t=`${window.location.href.split("#")[0]}#/preview/${e.file_id}_${"faq"===a?"xlsx":a}`;window.open(t,"_blank")}},queryFileBlank:async function(){const[a,s]=window.location.hash.split("/").pop().split("_");try{const l=await m(await f.getFile({file_id:a})),i=n(s);if(t.value=s,o.value=`data:${i};base64,${l.file_base64}`,"txt"===s||"md"===s||"csv"===s||"eml"===s||"jsonl"===s){const a=atob(l.file_base64);e.value=decodeURIComponent(escape(a))}}catch(l){d.error(l.msg||"获取文件失败")}},handleChatSourceChunk:e=>{b(!0),I(e.file_id),U(e.file_name)}}}var D=(e=>(e[e.success=0]="success",e[e.parsed=1]="parsed",e[e.error=2]="error",e[e.filebig=3]="filebig",e[e.loading=4]="loading",e[e.failed=5]="failed",e))(D||{}),j=(e=>(e[e.initing=0]="initing",e[e.default=1]="default",e[e.normal=2]="normal",e[e.optionlist=3]="optionlist",e))(j||{});const k=g().common,F=e("knowledgeBase",(()=>{const e=a("");c((()=>e.value),(()=>{}));const t=a([]),o=a(""),s=a([]),l=e=>{s.value=e},n=a([]),i=a(j.initing),r=e=>{i.value=e},u=a(!1);return{currentId:e,setCurrentId:a=>{e.value=a},knowledgeBaseList:s,setKnowledgeBaseList:l,showDeleteModal:u,setShowDeleteModal:e=>{u.value=e},showDefault:i,setDefault:r,getList:async()=>{var e,a;try{const o=await f.kbList();if(200==+o.code)if((null==(e=null==o?void 0:o.data)?void 0:e.length)>0){const e=o.data;l(e),r(j.normal),t.value.length||t.value.push(null==(a=e[0])?void 0:a.kb_id)}else l([]),r(j.default);else 500==+o.code&&(l([]),r(j.default),d.error(o.msg||k.error))}catch(o){l([]),r(j.default),d.error(o.msg||k.error)}},currentKbName:o,setCurrentKbName:e=>{o.value=e},selectList:t,setSelectList:e=>{t.value=e},knowledgeSearchList:n,setKnowledgeSearchList:e=>{n.value=e}}}),{persist:{storage:localStorage}});export{C as L,A as _,S as a,w as b,D as f,j as p,F as u};
